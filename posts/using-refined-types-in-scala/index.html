<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.737732f236b2a1e4c55e.css">html{font-size:100}body{background-color:#181a1b;background-image:url(/bg.jpg);margin:0 0 0 calc(100vw - 100%);color:#ddd;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#ddd;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#ddd 0,#ddd 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5dacff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#ddd;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#657b83}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#ddd}.Author-module--author__subtitle--cAaEB{color:#aaa;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap;-webkit-box-flex:0;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:-webkit-box;display:flex;align-content:center;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #3c3c3c}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:-webkit-box;display:flex;color:#ddd}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5dacff}.Copyright-module--copyright--1ariN{color:#d8d8d8;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#ddd;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5dacff;border-bottom:1px solid #5dacff}.Menu-module--menu__list-item-link--active--2CbUO{color:#ddd;border-bottom:1px solid #ddd}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#373737;background:-webkit-gradient(linear,left top,left bottom,from(#373737),color-stop(48%,#373737),to(#101213));background:linear-gradient(180deg,#373737 0,#373737 48%,#101213);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#ddd}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#ddd;border-bottom:1px solid #ddd}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#ddd;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5dacff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5dacff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5dacff;border-bottom:1px solid #5dacff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:-webkit-box;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5dacff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#ddd}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5dacff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#ddd}.Author-module--author--2Yefr{border-top:1px solid #373737;max-width:47.8125rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:66.875rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:47.8125rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:47.8125rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:47.8125rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #373737;text-decoration:none;border-radius:1.25rem;color:#ddd}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5dacff}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:47.8125rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#ddd;border:1px solid #373737;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5dacff}.Post-module--post--2ySQi a svg path{fill:#ddd}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.19.4"/><link rel="alternate" type="application/rss+xml" title="Zach Albia" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          let scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          let clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-157354380-1"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-157354380-1', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/icons/icon-48x48.png?v=413bea9c016926305518452afbb8d365"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="rgb(247, 160, 70)"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=413bea9c016926305518452afbb8d365"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=413bea9c016926305518452afbb8d365"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=413bea9c016926305518452afbb8d365"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=413bea9c016926305518452afbb8d365"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=413bea9c016926305518452afbb8d365"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=413bea9c016926305518452afbb8d365"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=413bea9c016926305518452afbb8d365"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=413bea9c016926305518452afbb8d365"/><title data-react-helmet="true">Using Refined Types in Scala - Zach Albia</title><meta data-react-helmet="true" name="description" content="Refined types are pretty cool for domain modeling it turns out"/><meta data-react-helmet="true" property="og:site_name" content="Using Refined Types in Scala - Zach Albia"/><meta data-react-helmet="true" property="og:image" content="https://zach-albia.github.io/media/42-line-bible.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Using Refined Types in Scala - Zach Albia"/><meta data-react-helmet="true" name="twitter:description" content="Refined types are pretty cool for domain modeling it turns out"/><meta data-react-helmet="true" name="twitter:image" content="https://zach-albia.github.io/media/42-line-bible.jpg"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-150a8e8248d1d3ef758f.js"/><link as="script" rel="preload" href="/app-d77b10f1720056fbd220.js"/><link as="script" rel="preload" href="/styles-bcdb26e7630f13d57549.js"/><link as="script" rel="preload" href="/netlify-identity-widget-37c0b748e504b2c574f0.js"/><link as="script" rel="preload" href="/commons-26085222a0aa5702b71b.js"/><link as="script" rel="preload" href="/webpack-runtime-ef490bee295d1fddda00.js"/><link as="fetch" rel="preload" href="/page-data/posts/using-refined-types-in-scala/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div class="Post-module--post--2ySQi"><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Using Refined Types in Scala</h1><div class="Content-module--content__body--2TrQ-"><h1 id="refined" style="position:relative;"><a href="#refined" aria-label="refined permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Refined</h1>
<p><a href="https://github.com/fthomas/refined" target="_blank" rel="nofollow noopener noreferrer">Refined</a> has some practical, useful ideas. There are obvious, clear benefits to domain modeling with refined types. Learning to use the library and getting used to it does have some overhead though, as with any new thing. We’ll be getting into the nitty-gritty of that overhead as I learn the library.</p>
<p>To have something to base this series on, I’ll work on <code class="language-text">adriann</code>’s <a href="https://adriann.github.io/programming_problems.html" target="_blank" rel="nofollow noopener noreferrer">Simple Programming Problems</a>, starting with Elementary Problem 3. We’re skipping 1 and 2 because they’re trivial and don’t benefit from refined types, anyway.</p>
<p>Here’s the problem statement:</p>
<blockquote>
<ol start="3">
<li>Modify the previous program such that only the users Alice and Bob are greeted with their names.</li>
</ol>
</blockquote>
<p>And here’s a solution to Problem 3:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>StdIn<span class="token punctuation">.</span>_

<span class="token keyword">object</span> Prob3 <span class="token punctuation">{</span>

  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span>
    println<span class="token punctuation">(</span>greet<span class="token punctuation">(</span>readLine<span class="token punctuation">(</span><span class="token string">"What's your name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">def</span> greet<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"Alice"</span> <span class="token operator">||</span> name <span class="token operator">==</span> <span class="token string">"Bob"</span><span class="token punctuation">)</span> s<span class="token string">"Hello, $name!"</span>
    <span class="token keyword">else</span> <span class="token string">"Go away!"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>So we’re reading a line, making a greeting out of the name the user enters, and printing that greeting to the console. Our greeting can be polite, if your name’s either <em>Alice</em> or <em>Bob</em>. We changed the problem a bit by being a bit standoffish to anyone with any other name.</p>
<p>What if we we’re given an empty <code class="language-text">String</code>? It’d be awkward to say <code class="language-text">&quot;Go away, !&quot;</code>. Like stuttering, but in writing. Let’s say we don’t ever want an empty <code class="language-text">String</code> for <code class="language-text">greet</code>.</p>
<p>Enter refined types.</p>
<p>First off, we could fix it in a lot of ways, but there’s already <a href="https://beyondthelines.net/programming/refined-types/" target="_blank" rel="nofollow noopener noreferrer">a good writeup</a> on why refined types are, at least IMO, one of the better ways. So let’s use them here.</p>
<p>First, we change our <code class="language-text">greet</code>’s signature:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> greet<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span> Refined NonEmpty<span class="token punctuation">)</span></code></pre></div>
<p>Already, we run into a problem in <code class="language-text">main</code>, because <code class="language-text">readLine</code> returns a <code class="language-text">String</code>, while <code class="language-text">greet</code> now wants a <code class="language-text">NonEmptyString</code>. While we’re at it, let’s add an alias for brevity:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">type</span> NonEmptyString <span class="token operator">=</span> <span class="token builtin">String</span> Refined NonEmpty</code></pre></div>
<p>We also have another, more pernicious problem in that we’re comparing the equality of a <code class="language-text">String</code> to a <code class="language-text">NonEmptyString</code>, which is a patently bad idea. The culprit here is <code class="language-text">name == &quot;Alice&quot; || name == &quot;Bob&quot;</code>.</p>
<p>At this point, I think it’s a good time to use Scalaz’s type-safe <code class="language-text">Equal</code>. Let’s change the expression to <code class="language-text">name === &quot;Alice&quot; || name === &quot;Bob&quot;</code>.</p>
<p>Now we have three errors, namely:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token punctuation">[</span>error<span class="token punctuation">]</span> value <span class="token operator">==</span><span class="token operator">=</span> is not a member of eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Refined<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span>eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>NonEmpty<span class="token punctuation">]</span>
<span class="token punctuation">[</span>error<span class="token punctuation">]</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"Alice"</span> <span class="token operator">||</span> name <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"Bob"</span><span class="token punctuation">)</span> s<span class="token string">"Hello, $name!"</span>
<span class="token punctuation">[</span>error<span class="token punctuation">]</span>              <span class="token operator">^</span>
<span class="token punctuation">[</span>error<span class="token punctuation">]</span> value <span class="token operator">==</span><span class="token operator">=</span> is not a member of eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Refined<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span>eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>NonEmpty<span class="token punctuation">]</span>
<span class="token punctuation">[</span>error<span class="token punctuation">]</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"Alice"</span> <span class="token operator">||</span> name <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"Bob"</span><span class="token punctuation">)</span> s<span class="token string">"Hello, $name!"</span>
<span class="token punctuation">[</span>error<span class="token punctuation">]</span>                                  <span class="token operator">^</span>
<span class="token punctuation">[</span>error<span class="token punctuation">]</span> <span class="token keyword">type</span> mismatch<span class="token punctuation">;</span>
<span class="token punctuation">[</span>error<span class="token punctuation">]</span>  found   <span class="token operator">:</span> <span class="token builtin">String</span>
<span class="token punctuation">[</span>error<span class="token punctuation">]</span>  required<span class="token operator">:</span> eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Refined<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span>eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>NonEmpty<span class="token punctuation">]</span></code></pre></div>
<p>This is a strictly better outcome than trying to compare the name read from user input, only for our conditional to always come up <code class="language-text">false</code> because they aren’t the same type! So how do we make our Equal typeclass work for refined types?</p>
<p>It turns out <code class="language-text">refined</code> has support for <code class="language-text">Equal</code> so let’s go with that and <code class="language-text">import eu.timepit.refined.scalaz._</code>. Note that we’ve had to add the dependency in <code class="language-text">build.sbt</code> with: <code class="language-text">libraryDependencies += &quot;eu.timepit&quot; %% &quot;refined-scalaz&quot; % &quot;0.8.4&quot;</code>. Refined also provides a way to automatically <em>lift</em> literals into refined types, so let’s use them with <code class="language-text">import eu.timepit.refined.auto._</code>.</p>
<p>Now that we’ve resolved the errors in our conditional, we are left with the following new error:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token punctuation">[</span>error<span class="token punctuation">]</span> compile<span class="token operator">-</span>time refinement only works <span class="token keyword">with</span> literals
<span class="token punctuation">[</span>error<span class="token punctuation">]</span>     println<span class="token punctuation">(</span>greet<span class="token punctuation">(</span>readLine<span class="token punctuation">(</span><span class="token string">"What's your name? "</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>error<span class="token punctuation">]</span>                           <span class="token operator">^</span></code></pre></div>
<p>And for good reason. There isn’t a way for our compiler to know if our user is entering a <code class="language-text">NonEmptyString</code>! The user can choose <em>not</em> to enter anything after all. With that in mind, we have to resolve the type <strong>at runtime</strong>. To do this, we <em>refine</em> our user input at runtime.</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">import</span> <span class="token namespace">eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>refineV</span>

<span class="token keyword">val</span> refinedUserInput<span class="token operator">:</span> Either<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> Refined<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> NonEmpty<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> 
      refineV<span class="token punctuation">[</span>NonEmpty<span class="token punctuation">]</span><span class="token punctuation">(</span>readLine<span class="token punctuation">(</span><span class="token string">"What's your name? "</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>When refining values at runtime, we end up with an <code class="language-text">Either[String, Refined[_, _]]</code>. At this point, we know we’ve reached the edge of our program. We <em>have</em> to rewrite <code class="language-text">main</code>. </p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  refineV<span class="token punctuation">[</span>NonEmpty<span class="token punctuation">]</span><span class="token punctuation">(</span>readLine<span class="token punctuation">(</span><span class="token string">"What's your name? "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">match</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> Right<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">=></span> println<span class="token punctuation">(</span>greet<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> Left<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">=></span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token comment">// what to do here?</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>By using refined types, we are <em>eventually forced</em> to deal with the case where our user enters an invalid name. Let’s say we decide to just tell the user that they didn’t enter a name. We can do that here.</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  refineV<span class="token punctuation">[</span>NonEmpty<span class="token punctuation">]</span><span class="token punctuation">(</span>readLine<span class="token punctuation">(</span><span class="token string">"What's your name? "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">match</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> Right<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">=></span> println<span class="token punctuation">(</span>greet<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> _ <span class="token keyword">=></span> println<span class="token punctuation">(</span><span class="token string">"You didn't enter a name!"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>We can even ask the user again, with recursion.</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span>
  refineV<span class="token punctuation">[</span>NonEmpty<span class="token punctuation">]</span><span class="token punctuation">(</span>readLine<span class="token punctuation">(</span><span class="token string">"What's your name? "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">match</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> Right<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">=></span> println<span class="token punctuation">(</span>greet<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> _ <span class="token keyword">=></span>
      println<span class="token punctuation">(</span><span class="token string">"You didn't enter a name!"</span><span class="token punctuation">)</span>
      main<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>Here’s the whole code:</p>
<div class="gatsby-highlight" data-language="scala"><pre class="language-scala"><code class="language-scala"><span class="token keyword">import</span> scalaz<span class="token punctuation">.</span>_
<span class="token keyword">import</span> Scalaz<span class="token punctuation">.</span>_
<span class="token keyword">import</span> <span class="token namespace">eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span>Refined
<span class="token keyword">import</span> <span class="token namespace">eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>collection</span><span class="token punctuation">.</span>NonEmpty
<span class="token keyword">import</span> <span class="token namespace">eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>scalaz</span><span class="token punctuation">.</span>_
<span class="token keyword">import</span> <span class="token namespace">eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>auto</span><span class="token punctuation">.</span>_
<span class="token keyword">import</span> <span class="token namespace">eu<span class="token punctuation">.</span>timepit<span class="token punctuation">.</span>refined<span class="token punctuation">.</span>refineV</span>

<span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>StdIn<span class="token punctuation">.</span>_

<span class="token keyword">object</span> Prob3 <span class="token punctuation">{</span>

  <span class="token keyword">type</span> NonEmptyString <span class="token operator">=</span> <span class="token builtin">String</span> Refined NonEmpty

  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span>
    refineV<span class="token punctuation">[</span>NonEmpty<span class="token punctuation">]</span><span class="token punctuation">(</span>readLine<span class="token punctuation">(</span><span class="token string">"What's your name? "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">match</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> Right<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">=></span> println<span class="token punctuation">(</span>greet<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">case</span> _ <span class="token keyword">=></span>
        println<span class="token punctuation">(</span><span class="token string">"You didn't enter a name!"</span><span class="token punctuation">)</span>
        main<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

  <span class="token keyword">def</span> greet<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span> Refined NonEmpty<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"Alice"</span> <span class="token operator">||</span> name <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"Bob"</span><span class="token punctuation">)</span> s<span class="token string">"Hello, $name!"</span>
    <span class="token keyword">else</span> s<span class="token string">"Go away, $name!"</span>
<span class="token punctuation">}</span></code></pre></div></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->21 Oct 2017</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/domain-modeling/">domain-modeling</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/refined-types/">refined-types</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/scala/">scala</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/intermediate/">intermediate</a></li></ul></div><div class="Author-module--author--2Yefr"><p>Functional programming, Scala and TypeScript have been my focus lately.<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/ZachAlbia" rel="noopener noreferrer" target="_blank"><strong>Zachary Albia</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"><div><div id="disqus_thread"></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/using-refined-types-in-scala";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-d77b10f1720056fbd220.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-1d9b46fa5d1abe87c6c2.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-03a49449e1a83219ee25.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-a2e90741117318dccc8e.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-c80da1deed6cdc790507.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-150a8e8248d1d3ef758f.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-810658bccdc62389af6f.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-e80dd48a73da29e213db.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-f9d9e1cf073a4fab3bce.js"]};/*]]>*/</script><script src="/webpack-runtime-ef490bee295d1fddda00.js" async=""></script><script src="/commons-26085222a0aa5702b71b.js" async=""></script><script src="/netlify-identity-widget-37c0b748e504b2c574f0.js" async=""></script><script src="/styles-bcdb26e7630f13d57549.js" async=""></script><script src="/app-d77b10f1720056fbd220.js" async=""></script><script src="/component---src-templates-post-template-js-150a8e8248d1d3ef758f.js" async=""></script></body></html>