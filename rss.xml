<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Zach Albia]]></title><description><![CDATA[Developer, musician. Currently into functional programming]]></description><link>https://zach-albia.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 06 Feb 2020 08:46:49 GMT</lastBuildDate><item><title><![CDATA[Eff in Context]]></title><description><![CDATA[Looking at Scala's version of the eff monad in context in comparison with other functional approaches]]></description><link>https://zach-albia.github.io/posts/eff-in-context</link><guid isPermaLink="false">https://zach-albia.github.io/posts/eff-in-context</guid><pubDate>Tue, 31 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Learning how to use &lt;a href=&quot;https://github.com/atnos-org/eff&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Eff in Scala&lt;/a&gt;, let alone learning how it works on the inside, is quite the challenge for me and I believe for many people too. I feel that there’s quite the chasm from running a few easy examples to putting together a full app using Eff.&lt;/p&gt;
&lt;h2 id=&quot;contents&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#contents&quot; aria-label=&quot;contents permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Contents&lt;/h2&gt;
&lt;div class=&quot;toc&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#many-ways-to-say-hello&quot;&gt;Many ways to say Hello&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#the-simplest-way&quot;&gt;The simplest way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-testable-way&quot;&gt;The &lt;em&gt;testable&lt;/em&gt; way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-reader-way&quot;&gt;The Reader way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-reader-writer-way&quot;&gt;The &lt;em&gt;Reader-Writer&lt;/em&gt; way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-reader-writer-either-way&quot;&gt;The &lt;em&gt;Reader-Writer-Either&lt;/em&gt; Way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-monad-transformer-way&quot;&gt;The &lt;em&gt;Monad Transformer&lt;/em&gt; Way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-eff-monad-way&quot;&gt;The &lt;em&gt;Eff Monad&lt;/em&gt; Way&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;However, Eff has a great amount of documentation for the initiated FP user in Scala. In fact, there’s even a set of exercises in &lt;a href=&quot;https://github.com/benhutchison/GettingWorkDoneWithExtensibleEffects/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;&lt;em&gt;“Getting Work Done With Extensible Effects”&lt;/em&gt;&lt;/a&gt; that guide you in a methodical way towards understanding how you might use Eff in a real, non-trivial app. There’s even &lt;a href=&quot;https://vimeo.com/channels/flatmap2016/165927840&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;a great presentation&lt;/a&gt; about a practical way to use Eff in bigger projects, though I’ve yet to see the usage of the overall framework described in it in a sample application. I hope there’s one out there and I hope I just missed it. Or maybe it’s not needed at all.&lt;/p&gt;
&lt;p&gt;That said, I think there’s still a part of that chasm that needs to be covered. It’s somewhere in between someone starting out with FP in Scala and the aforementioned exercises by Ben Hutchinson. I think there’s some value in going back to the simplest problems and seeing what Eff looks like there.&lt;/p&gt;
&lt;p&gt;I’m planning to have this series span the first set of adriannn’s &lt;a href=&quot;https://adriann.github.io/programming_problems.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Simple Programming Problems&lt;/a&gt;, namely the &lt;em&gt;Elementary Problems&lt;/em&gt;. &lt;a href=&quot;https://github.com/zach-albia/learning-eff&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;This series’ code&lt;/a&gt; is available on Github. We kick things off with our first problem:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Write a program that prints ‘Hello World’ to the screen.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;many-ways-to-say-hello&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#many-ways-to-say-hello&quot; aria-label=&quot;many ways to say hello permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Many ways to say Hello&lt;/h1&gt;
&lt;h2 id=&quot;the-simplest-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-simplest-way&quot; aria-label=&quot;the simplest way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The simplest way&lt;/h2&gt;
&lt;p&gt;Our first jab at the problem begins with the simplest possible example that we’re taught when we first learn to program in any language. Our first problem happens to be Scala’s Hello World:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass01 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s simple, but inflexible. You can only ever print to the console here. Period. What if we wanted to print &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt; to a file? Also, how do we know it works? We run it, and it prints &lt;code class=&quot;language-text&quot;&gt;Hello World&lt;/code&gt; to the console. But we did have to look at the characters it prints out. And we did have to make sure &lt;em&gt;every single character&lt;/em&gt; lines up to make the string &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt;. We aren’t exactly perfect at reading either, and our eyes can trip and think we’re reading the right string when we’re not!&lt;/p&gt;
&lt;p&gt;If it can happen to us in a simple “Hello World”, imagine what would happen if we had to do it for any bigger program. We say we &lt;strong&gt;cannot test&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;. It’s opaque to any testing effort unless we go to great lengths just to read the output on the console itself. Let’s see if we can test one of the simplest programs ever.&lt;/p&gt;
&lt;h2 id=&quot;the-testable-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-testable-way&quot; aria-label=&quot;the testable way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;testable&lt;/em&gt; way&lt;/h2&gt;
&lt;p&gt;At the heart of software development is getting things done &lt;em&gt;automatically&lt;/em&gt;. That includes testing. We have to restructure our tiny Hello World app so we can run a test:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;to see if our program compiles,&lt;/li&gt;
&lt;li&gt;to see if it works as expected without having to look at our program’s console output, and&lt;/li&gt;
&lt;li&gt;to be able to automatically do both 1 &amp;#x26; 2 repeatedly.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Here is one way to refactor our code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass02 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; defaultPrintln&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Predef&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;defaultPrintln&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;println&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; is now totally &lt;em&gt;divorced&lt;/em&gt; from the concept of the console. We might as well write &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt; in crop circles, given the right &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;. More practically, now we can write code to test &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Prob01Pass01&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scalatest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; Prob01Spec &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; FlatSpec &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Matchers &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; mockPrintln&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; _ should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token string&quot;&gt;&quot;our second pass at printHelloWorld&quot;&lt;/span&gt; should
      &lt;span class=&quot;token string&quot;&gt;&quot;print hello world to a println function&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Prob01Pass02&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_ should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our test code &lt;em&gt;intercepts&lt;/em&gt; what’s passed to our function. This allows us to automatically confirm that, for whatever way we can print &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; will receive &lt;em&gt;exactly&lt;/em&gt; the string &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt; and &lt;em&gt;nothing else&lt;/em&gt;.&lt;/p&gt;
&lt;h2 id=&quot;the-reader-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-reader-way&quot; aria-label=&quot;the reader way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Reader way&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; is a function that takes a &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; function and runs it on &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt;, giving back &lt;code class=&quot;language-text&quot;&gt;Unit&lt;/code&gt;. Reader is just an effect in the form of a function taking one parameter which yields our value, the return value. Let’s look at our testable code in terms of Reader:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Reader

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass03 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; defaultPrintln&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Predef&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld

    &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
    program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;defaultPrintln&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; printHelloWorld&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Reader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; println &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our code is very similar to our second pass. Note that we only had to change a little bit of code Since &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; and a function with one parameter, namely &lt;code class=&quot;language-text&quot;&gt;Function1[A, B]&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;A =&amp;gt; B&lt;/code&gt; in Scala, are practically one and the same. In our usage of &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; here, we mean it to &lt;em&gt;delay reading or asking for&lt;/em&gt;  a &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;  function in order to &lt;em&gt;return&lt;/em&gt; &lt;code class=&quot;language-text&quot;&gt;Unit&lt;/code&gt;, i.e. to make some side effect(s). I think “Reader” is a weird name for it. It’d probably make more sense as the “Context”, “Config” or “Dependency”. But what do I know?&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; also allows us to write tests:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;our third pass at printHelloWorld&quot;&lt;/span&gt; should
    &lt;span class=&quot;token string&quot;&gt;&quot;be a flexible hello world program&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Prob01Pass03&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld

  program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_ should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By using &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; , in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt; we end up with a pure &lt;em&gt;description&lt;/em&gt; of our “Hello World” program in &lt;code class=&quot;language-text&quot;&gt;program&lt;/code&gt;. A pure program that we can interpret, or &lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt; any way we want.&lt;/p&gt;
&lt;p&gt;It’s pure in the sense that we can call &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; any number of times and it won’t have any side effects, and will &lt;em&gt;always&lt;/em&gt; return the same program. I’ve read a lot of material with the idea that &lt;em&gt;functional programs are descriptions of programs that you run&lt;/em&gt;. This looks like it fits the bill.&lt;/p&gt;
&lt;p&gt;We can interpret our program in another way with the use of a &lt;em&gt;“fake”&lt;/em&gt; or a &lt;em&gt;“mock”&lt;/em&gt; &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;—one that just checks if it got passed &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt;. We could even interpret &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; to print the line to a file, or write a smoke message in the sky with an autonomous drone given the right &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; function.&lt;/p&gt;
&lt;p&gt;What does Reader buy us? There is some extra cognitive overhead here for sure. We’ve had to learn Reader when we could have just stuck to our second pass by just passing functions. We’ve gained &lt;em&gt;the flexibility and the concept&lt;/em&gt; of a pure program, one that could be interpreted in many ways, one of which is useful for testing. What else can we gain?&lt;/p&gt;
&lt;h2 id=&quot;the-reader-writer-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-reader-writer-way&quot; aria-label=&quot;the reader writer way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;Reader-Writer&lt;/em&gt; way&lt;/h2&gt;
&lt;p&gt;Say, for our fourth pass, we wanted to know how fast “Hello World” runs on our computer. The simplest, non-testable way looks something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass04 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;currentTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;currentTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $time ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our problem with this code is that it doesn’t easily allow us to change &lt;em&gt;how&lt;/em&gt; we print “Hello World”, as well as &lt;em&gt;how&lt;/em&gt; we read the time. &lt;code class=&quot;language-text&quot;&gt;System.getCurrentTimeMillis&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; here are impure functions. &lt;code class=&quot;language-text&quot;&gt;System.getCurrentTimeMillis&lt;/code&gt; observes the side effect of passing time while &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; has the side effect of writing to a console. Consequently, besides testing Hello World, we can’t test if it’s logging the right amount of time.&lt;/p&gt;
&lt;p&gt;Let’s make an &lt;code class=&quot;language-text&quot;&gt;AppConfig&lt;/code&gt; trait and give it the default console and system time version that we can use in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;trait&lt;/span&gt; AppConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@throws&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;classOf&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Exception&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; startTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; endTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; AppConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AppConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; AppConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Predef&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; startTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;currentTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; endTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;currentTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that we’ve declared that our &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; can fail. This is due to &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; being flexible enough for this to happen. Now that we have &lt;code class=&quot;language-text&quot;&gt;AppConfig&lt;/code&gt; nailed down, let’s see what we can do with &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;implicits&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass05 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld

    &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeElapsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $timeElapsed ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; printHelloWorld&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Reader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; appCfg &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Looking at &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; is run twice. That’s because our program now has &lt;em&gt;two&lt;/em&gt; effects, &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt;. Our third pass only had &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; so we’ve only had to call &lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt; once. In FP, pure programs like &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; will be run or &lt;em&gt;interpreted&lt;/em&gt; as many times as it has effects. Once we &lt;em&gt;interpret&lt;/em&gt; all those effects, we end up with the output of our pure program, in this case, a &lt;code class=&quot;language-text&quot;&gt;(Long, Unit)&lt;/code&gt; tuple, the first part of which contains our &lt;code class=&quot;language-text&quot;&gt;timeElapsed&lt;/code&gt; in milliseconds.&lt;/p&gt;
&lt;p&gt;With &lt;code class=&quot;language-text&quot;&gt;AppConfig&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt;, we’ve decoupled our code from the console and the system clock. Note that we’ve had to manually &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; our &lt;code class=&quot;language-text&quot;&gt;timeElapsed&lt;/code&gt; report in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;, since the second &lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt; produces a pure log of &lt;code class=&quot;language-text&quot;&gt;timeElapsed&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;With this, we can write a test for our fifth pass that checks both printing Hello World and logging the time.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; MockAppConfig &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; AppConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; s should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; startTime&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; endTime&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token string&quot;&gt;&quot;our fifth pass at printHelloWorld&quot;&lt;/span&gt; should
    &lt;span class=&quot;token string&quot;&gt;&quot;be a flexible, timed hello world program&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Prob01Pass05&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeElapsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockAppConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run
  timeElapsed should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s take a closer look at our &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; program itself.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; printHelloWorld&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Reader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; appCfg &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We have a stack of two effects, Reader &amp;#x26; Writer. Our &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; needs access to &lt;code class=&quot;language-text&quot;&gt;appCfg&lt;/code&gt; to log the time, which means &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; has to be on the top of our effect stack. Note how we’ve had to manually stack our &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; program inside our &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt;. Though we did also gain the ability for our computation (printing Hello World, mind you), to have multiple effects.&lt;/p&gt;
&lt;p&gt;If we had to stack more effects, our pure program code would get more and more unwieldy and shift further and further to the right. To illustrate this, let’s have a go at adding error handling to our stack.&lt;/p&gt;
&lt;h2 id=&quot;the-reader-writer-either-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-reader-writer-either-way&quot; aria-label=&quot;the reader writer either way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;Reader-Writer-Either&lt;/em&gt; Way&lt;/h2&gt;
&lt;p&gt;Our &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; can throw an exception, as declared in &lt;code class=&quot;language-text&quot;&gt;AppConfig&lt;/code&gt;. After all, we could have our pure program tell a rover on Mars to print “Hello World” on Martian sand, again given the right &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;function. We could very easily lose our connection to the rover! As programmers, we have to be prepared for this scenario. Let’s add error-handling to our stack.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;implicits&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass06 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld

    &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeElapsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run
    result &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Hello world failed: $e&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _       &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $timeElapsed ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; ReaderWriterEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; printHelloWorld&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ReaderWriterEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Reader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; appCfg &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        e &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; e&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Exception &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; e
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;, after we &lt;em&gt;run&lt;/em&gt; or &lt;em&gt;remove a layer&lt;/em&gt; from the pure program twice, we have one last layer in error handling. We have to handle any errors that might have occurred during the course of its execution.&lt;/p&gt;
&lt;p&gt;Our hand-rolled &lt;code class=&quot;language-text&quot;&gt;ReaderWriterEither[A]&lt;/code&gt; stack now contains &lt;code class=&quot;language-text&quot;&gt;Reader[AppConfig, ?]&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Writer[Long, ?]&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Either[Throwable, ?]&lt;/code&gt;. Note how we’ve had to have &lt;em&gt;yet another level of indentation&lt;/em&gt; just to support error handling. &lt;/p&gt;
&lt;p&gt;A test for this code looks like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; MockUnreachableRover &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; AppConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; exception &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; Exception&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Couldn&apos;t connect to Mars!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; exception &lt;span class=&quot;token comment&quot;&gt;// this matters&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; startTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// these values&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; endTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;   &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// don&apos;t matter&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token string&quot;&gt;&quot;our sixth pass at printHelloWorld&quot;&lt;/span&gt; should
    &lt;span class=&quot;token string&quot;&gt;&quot;be a flexible, timed, resilient hello world program&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Prob01Pass06&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeElapsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockAppConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run
  timeElapsed should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockUnreachableRover&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run
  result should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockUnreachableRover&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our tests say it all. We now have a Hello World program that’s flexible (allowing any &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;), timed (in ms), and resilient (by catching errors). By now we should be able to say it’s all worth it. If we know how to imbue our humble Hello World program with these qualities, we now stand a chance at ensuring all our functional programs have the same qualities. But our &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; already looks rather &lt;em&gt;tedious&lt;/em&gt;. Scale it to any bigger program and it becomes a maintenance and readability nightmare. There has to be a better way to write functional programs. This calls for a more suitable abstraction.&lt;/p&gt;
&lt;h2 id=&quot;the-monad-transformer-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-monad-transformer-way&quot; aria-label=&quot;the monad transformer way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;Monad Transformer&lt;/em&gt; Way&lt;/h2&gt;
&lt;p&gt;One way is to use monad transformers to flatten our for-comprehension:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;implicits&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ReaderT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; WriterT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass07 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld

    &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
    program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                   &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Hello world failed: $e&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeElapsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
        println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $timeElapsed ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; EitherThrowable&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; WriterLongEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; WriterT&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;EitherThrowable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; ReaderWriterEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ReaderT&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;WriterLongEither&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; printHelloWorld&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ReaderWriterEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      appConfig &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; ask&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;WriterLongEither&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AppConfig&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      _         &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; logTime&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      either    &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; ReaderT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lift&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;WriterLongEither&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                     WriterT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lift&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;EitherThrowable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                       &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                         Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                       &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; e&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Throwable &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
                         Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                       &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                     &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      _         &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; logTime&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; either

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; logTime&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ReaderWriterEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; ReaderT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lift&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;WriterLongEither&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This was a &lt;strong&gt;bitch&lt;/strong&gt; to write, and it’s as clean as I could get it with my limited knowledge of &lt;code class=&quot;language-text&quot;&gt;cats&lt;/code&gt;. I’m pretty sure there’s a way more compact way to write this that involves &lt;code class=&quot;language-text&quot;&gt;cats.EitherT&lt;/code&gt;. The &lt;code class=&quot;language-text&quot;&gt;cats&lt;/code&gt; library’s implicits here mean that anytime we have to use &lt;code class=&quot;language-text&quot;&gt;ReaderT&lt;/code&gt;’s functions &lt;code class=&quot;language-text&quot;&gt;ask&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;lift&lt;/code&gt;, we’ve had to specify exactly what it is we’re stacking a &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; on top of. Otherwise, we get all sorts of nasty compilation errors.&lt;/p&gt;
&lt;p&gt;It is somewhat of an improvement though, in that we’re able to specify our application logic in &lt;em&gt;only one layer&lt;/em&gt; of a for-comprehension. It’s the lifting part that stings. Stacking together three effects doesn’t seem to get us the concise code that we want.&lt;/p&gt;
&lt;p&gt;Our test code is fairly trivial and similar to the last one:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;our seventh pass monad transformers printHelloWorld&quot;&lt;/span&gt; should
  &lt;span class=&quot;token string&quot;&gt;&quot;be a flexible, timed, resilient hello world program&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Prob01Pass07&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld

  program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockAppConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockUnreachableRover&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockUnreachableRover&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;the-eff-monad-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-eff-monad-way&quot; aria-label=&quot;the eff monad way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;Eff Monad&lt;/em&gt; Way&lt;/h2&gt;
&lt;p&gt;Let’s let the code do the talking this time:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;atnos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eff&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;atnos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eff&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;atnos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eff&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;syntax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass08 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Stack &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Fx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fx3&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Stack&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; result&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      program
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runReader&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runWriterUnsafe&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runEither
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run

    result &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Our program&apos;s result is a side effect that can fail.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
        println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Hello world failed: $e&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; _appCfg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; R
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; _timeReport&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; R

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _appCfg &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _timeReport &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _throwableEither&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Eff&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    appConfig &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; ask
    start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTimeMillis
    either    &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; catchNonFatalThrowable&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    durationInMs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTimeMillis &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start
    _         &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $durationInMs ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; either
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s embarrassing how stupidly simple &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; looks compared to passes 6 and 7. Let’s break each part down to see how it all works.&lt;/p&gt;
&lt;p&gt;We define our program’s effect stack using a type declaration as shown below.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Stack &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Fx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fx3&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Fx.fx3&lt;/code&gt; means we have three effects as shown. Eff supports up to 12 effects stacked with &lt;code class=&quot;language-text&quot;&gt;Fx.fx12&lt;/code&gt;. Why the seemingly arbitrary selection of 12? I don’t know. Probably something to do with the Scala compiler? At any rate, we’ll need this later for &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt; to know how to interpret our pure program. We also need &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; to declare what sort of effects it needs. Before we do that, we make a couple of type declarations:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; _appCfg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; R
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; _timeReport&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; R&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We need these since &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; both accept two type parameters. Now we use them in our &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; signature:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _appCfg &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _timeReport &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _throwableEither&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Eff&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  appConfig &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; ask
  start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTimeMillis
  either    &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; catchNonFatalThrowable&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  durationInMs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTimeMillis &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start
  _         &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $durationInMs ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; either&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s almost as if someone put together &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; and combined them together into one monad. We simply &lt;code class=&quot;language-text&quot;&gt;ask&lt;/code&gt; the &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; for the config, catch &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; errors with &lt;code class=&quot;language-text&quot;&gt;catchNonFatalThrowable&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;tell&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; to write our running time to some log.&lt;/p&gt;
&lt;p&gt;Finally, let’s go take a look at &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Stack&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; result&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    program
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runReader&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runWriterUnsafe&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runEither
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run

  result &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Our program&apos;s result is a side effect that can fail.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
      println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Hello world failed: $e&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We first let &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; know it runs under a stack of effects as specified earlier in our &lt;code class=&quot;language-text&quot;&gt;Stack&lt;/code&gt; type. At the end of the world, we run our effects exactly in the order shown above. Remember, we need to &lt;code class=&quot;language-text&quot;&gt;runReader&lt;/code&gt; before &lt;code class=&quot;language-text&quot;&gt;runWriterUnsafe&lt;/code&gt; because our usage of the &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; effect in &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; depends on there being an &lt;code class=&quot;language-text&quot;&gt;AppConfig&lt;/code&gt;, i.e. it needs to get the current time to write &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;’s running time.&lt;/p&gt;
&lt;p&gt;Note that &lt;code class=&quot;language-text&quot;&gt;runWriterUnsafe&lt;/code&gt; means we can just write our logs in a function with side effects, e.g. &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; to console. You can choose to log this anywhere. Very handy when you have to log a lot of stuff and you don’t want your logs to eat up all your RAM like Google Chrome does. When we &lt;code class=&quot;language-text&quot;&gt;runEither&lt;/code&gt;, we’re left with only one effect, &lt;code class=&quot;language-text&quot;&gt;Eff&lt;/code&gt;. You can think of &lt;code class=&quot;language-text&quot;&gt;Eff&lt;/code&gt; as an effect that combines other effects. We finally get &lt;code class=&quot;language-text&quot;&gt;result&lt;/code&gt; with the last &lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Our final act in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt; is handling any errors that might have occurred while trying to print &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt;. &lt;code class=&quot;language-text&quot;&gt;e&lt;/code&gt; in &lt;code class=&quot;language-text&quot;&gt;Left(e)&lt;/code&gt; contains our possible error while &lt;code class=&quot;language-text&quot;&gt;Right&lt;/code&gt; only contains &lt;code class=&quot;language-text&quot;&gt;Unit&lt;/code&gt;, which we can just ignore.&lt;/p&gt;
&lt;p&gt;Looking at &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;, we get the notion that the entire goal of our program is to produce a side effect, which can fail non-fatally.&lt;/p&gt;
&lt;p&gt;How do we test our Eff program? We just interpret it a different way.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;our eighth pass printHelloWorld Eff monad program&quot;&lt;/span&gt; should
  &lt;span class=&quot;token string&quot;&gt;&quot;be flexible, timed, and resilient&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Prob01Pass08&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Prob01Pass08&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Stack&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; runningMock&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AppConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; MockAppConfig
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; failingMock&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AppConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; MockUnreachableRover

  program
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runReader&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runningMock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runWriter
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runEither
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; List&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in 2 ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  program
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runReader&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;failingMock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runWriter
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runEither
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockUnreachableRover&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;conclusion&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;FP can be difficult without the proper abstractions. Even Hello World can get unwieldy. That isn’t to say our FP versions are invariably harder than procedural code or “mainstream” OOP equivalents. Indeed these versions can yield even more difficult, opaque code.&lt;/p&gt;
&lt;p&gt;Our pure programs, however, are highly composable, easier to reason about, and can very easily be made asynchronous, concurrent, and parallel just by adding some &lt;code class=&quot;language-text&quot;&gt;Task&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;Future&lt;/code&gt; effect on the stack and in our pure program’s code. It’s just not as easy to do the same in procedural/OOP code. To see this in action, if this article has helped you understand the whole point of the Eff monad, I strongly suggest you move on to working on the excellent exercises in Ben Hutchinson’s &lt;a href=&quot;https://github.com/benhutchison/GettingWorkDoneWithExtensibleEffects/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;&lt;em&gt;“Getting Work Done With Extensible Effects”&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are two other ways to express our stack that I didn’t include here for lack of time. One way is with the free monad and the other is by rolling out your own &lt;code class=&quot;language-text&quot;&gt;ReaderWriterEither[R, T, L, A]&lt;/code&gt; type which effectively lets you have the same level of abstraction as with Eff. I leave these two as exercises for the reader.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Using Refined Types in Scala]]></title><description><![CDATA[Refined types are pretty cool for domain modeling it turns out]]></description><link>https://zach-albia.github.io/posts/using-refined-types-in-scala</link><guid isPermaLink="false">https://zach-albia.github.io/posts/using-refined-types-in-scala</guid><pubDate>Sat, 21 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/fthomas/refined&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Refined&lt;/a&gt; has some practical, useful ideas. There are obvious, clear benefits to domain modeling with refined types. Learning to use the library and getting used to it does have some overhead though, as with any new thing. We’ll be getting into the nitty-gritty of that overhead as I learn the library.&lt;/p&gt;
&lt;p&gt;To have something to base this series on, I’ll work on &lt;code class=&quot;language-text&quot;&gt;adriann&lt;/code&gt;’s &lt;a href=&quot;https://adriann.github.io/programming_problems.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Simple Programming Problems&lt;/a&gt;, starting with Elementary Problem 3. We’re skipping 1 and 2 because they’re trivial and don’t benefit from refined types, anyway.&lt;/p&gt;
&lt;p&gt;Here’s the problem statement:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;Modify the previous program such that only the users Alice and Bob are greeted with their names.&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;And here’s a solution to Problem 3:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;scala&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StdIn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob3 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; s&lt;span class=&quot;token string&quot;&gt;&quot;Hello, $name!&quot;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Go away!&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So we’re reading a line, making a greeting out of the name the user enters, and printing that greeting to the console. Our greeting can be polite, if your name’s either &lt;em&gt;Alice&lt;/em&gt; or &lt;em&gt;Bob&lt;/em&gt;. We changed the problem a bit by being a bit standoffish to anyone with any other name.&lt;/p&gt;
&lt;p&gt;What if we we’re given an empty &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt;? It’d be awkward to say &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Go away, !&amp;quot;&lt;/code&gt;. Like stuttering, but in writing. Let’s say we don’t ever want an empty &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt; for &lt;code class=&quot;language-text&quot;&gt;greet&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Enter refined types.&lt;/p&gt;
&lt;p&gt;First off, we could fix it in a lot of ways, but there’s already &lt;a href=&quot;https://beyondthelines.net/programming/refined-types/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;a good writeup&lt;/a&gt; on why refined types are, at least IMO, one of the better ways. So let’s use them here.&lt;/p&gt;
&lt;p&gt;First, we change our &lt;code class=&quot;language-text&quot;&gt;greet&lt;/code&gt;’s signature:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; Refined NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Already, we run into a problem in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;, because &lt;code class=&quot;language-text&quot;&gt;readLine&lt;/code&gt; returns a &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt;, while &lt;code class=&quot;language-text&quot;&gt;greet&lt;/code&gt; now wants a &lt;code class=&quot;language-text&quot;&gt;NonEmptyString&lt;/code&gt;. While we’re at it, let’s add an alias for brevity:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; NonEmptyString &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; Refined NonEmpty&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We also have another, more pernicious problem in that we’re comparing the equality of a &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt; to a &lt;code class=&quot;language-text&quot;&gt;NonEmptyString&lt;/code&gt;, which is a patently bad idea. The culprit here is &lt;code class=&quot;language-text&quot;&gt;name == &amp;quot;Alice&amp;quot; || name == &amp;quot;Bob&amp;quot;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;At this point, I think it’s a good time to use Scalaz’s type-safe &lt;code class=&quot;language-text&quot;&gt;Equal&lt;/code&gt;. Let’s change the expression to &lt;code class=&quot;language-text&quot;&gt;name === &amp;quot;Alice&amp;quot; || name === &amp;quot;Bob&amp;quot;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now we have three errors, namely:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; is not a member of eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Refined&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;collection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;     &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; s&lt;span class=&quot;token string&quot;&gt;&quot;Hello, $name!&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;              &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; is not a member of eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Refined&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;collection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;     &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; s&lt;span class=&quot;token string&quot;&gt;&quot;Hello, $name!&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;                                  &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; mismatch&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;  found   &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;  required&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Refined&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;collection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is a strictly better outcome than trying to compare the name read from user input, only for our conditional to always come up &lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt; because they aren’t the same type! So how do we make our Equal typeclass work for refined types?&lt;/p&gt;
&lt;p&gt;It turns out &lt;code class=&quot;language-text&quot;&gt;refined&lt;/code&gt; has support for &lt;code class=&quot;language-text&quot;&gt;Equal&lt;/code&gt; so let’s go with that and &lt;code class=&quot;language-text&quot;&gt;import eu.timepit.refined.scalaz._&lt;/code&gt;. Note that we’ve had to add the dependency in &lt;code class=&quot;language-text&quot;&gt;build.sbt&lt;/code&gt; with: &lt;code class=&quot;language-text&quot;&gt;libraryDependencies += &amp;quot;eu.timepit&amp;quot; %% &amp;quot;refined-scalaz&amp;quot; % &amp;quot;0.8.4&amp;quot;&lt;/code&gt;. Refined also provides a way to automatically &lt;em&gt;lift&lt;/em&gt; literals into refined types, so let’s use them with &lt;code class=&quot;language-text&quot;&gt;import eu.timepit.refined.auto._&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now that we’ve resolved the errors in our conditional, we are left with the following new error:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; compile&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;time refinement only works &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; literals
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;     println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;                           &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And for good reason. There isn’t a way for our compiler to know if our user is entering a &lt;code class=&quot;language-text&quot;&gt;NonEmptyString&lt;/code&gt;! The user can choose &lt;em&gt;not&lt;/em&gt; to enter anything after all. With that in mind, we have to resolve the type &lt;strong&gt;at runtime&lt;/strong&gt;. To do this, we &lt;em&gt;refine&lt;/em&gt; our user input at runtime.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refineV&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; refinedUserInput&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Refined&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; 
      refineV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When refining values at runtime, we end up with an &lt;code class=&quot;language-text&quot;&gt;Either[String, Refined[_, _]]&lt;/code&gt;. At this point, we know we’ve reached the edge of our program. We &lt;em&gt;have&lt;/em&gt; to rewrite &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  refineV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// what to do here?&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By using refined types, we are &lt;em&gt;eventually forced&lt;/em&gt; to deal with the case where our user enters an invalid name. Let’s say we decide to just tell the user that they didn’t enter a name. We can do that here.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  refineV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You didn&apos;t enter a name!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can even ask the user again, with recursion.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  refineV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
      println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You didn&apos;t enter a name!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here’s the whole code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; scalaz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Scalaz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Refined
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;collection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NonEmpty
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scalaz&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;auto&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refineV&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;scala&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StdIn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob3 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; NonEmptyString &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; Refined NonEmpty

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    refineV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
        println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You didn&apos;t enter a name!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; Refined NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; s&lt;span class=&quot;token string&quot;&gt;&quot;Hello, $name!&quot;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; s&lt;span class=&quot;token string&quot;&gt;&quot;Go away, $name!&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item></channel></rss>