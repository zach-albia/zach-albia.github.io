<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Zach Albia]]></title><description><![CDATA[Developer, musician. Currently into functional programming]]></description><link>https://zach-albia.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Mon, 10 Feb 2020 16:35:19 GMT</lastBuildDate><item><title><![CDATA[My FP Journey]]></title><description><![CDATA[The long and winding road that led me to pure functional programming]]></description><link>https://zach-albia.github.io/posts/my-fp-journey</link><guid isPermaLink="false">https://zach-albia.github.io/posts/my-fp-journey</guid><pubDate>Mon, 10 Feb 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I wasn’t always into FP. I could’ve been, but it took me a little over 3 years ago to buy into it and get to where I am now, which I think is at a decent-enough level.ʲᵒᵇ ᵖˡˢ&lt;/p&gt;
&lt;p&gt;My first programming language was this odd little thing called Scheme; taught to us in our sophomore year in high school. There was this lambda symbol emblazoned on the shortcut to what I remember to be its IDE with a REPL. Come to think of it, I’m pretty sure it was called &lt;a href=&quot;http://cs.brown.edu/courses/cs009/02/drscheme_intro/scheme.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Dr. Scheme&lt;/a&gt; then.&lt;/p&gt;
&lt;h2 id=&quot;contents&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#contents&quot; aria-label=&quot;contents permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Contents&lt;/h2&gt;
&lt;div class=&quot;toc&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#high-school--uni&quot;&gt;High School &amp;#x26; Uni&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#some-respite-in-sql&quot;&gt;Some respite in SQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#in-sql-we-trust&quot;&gt;In SQL we trust&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#into-the-real-world&quot;&gt;Into the real world&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#rediscovering-javascript&quot;&gt;Rediscovering JavaScript&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#teaching-myself-fp&quot;&gt;Teaching myself FP&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#a-dalliance-with-groovy&quot;&gt;A dalliance with Groovy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#scala&quot;&gt;Scala&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#akka&quot;&gt;Akka?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-red-book-functional-programming-in-scala&quot;&gt;The Red Book (Functional Programming in Scala)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#scalaz-cats&quot;&gt;Scalaz, Cats&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#fp-ddd-and-functional-effects&quot;&gt;FP, DDD, and functional effects&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#eff-and-tagless-final&quot;&gt;Eff and Tagless Final&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#zio&quot;&gt;ZIO&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#looking-forward&quot;&gt;Looking Forward&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#next-steps&quot;&gt;Next Steps&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;figure class=&quot;float-right&quot; style=&quot;width: 300px&quot;&gt;
	&lt;img src=&quot;/media/dr-scheme.jpg&quot; alt=&quot;Dr. Scheme screenshot&quot;&gt;
	&lt;figcaption&gt;Dark mode wasn&apos;t a thing then...&lt;/figcaption&gt;
	&lt;figcaption class=&quot;attrib&quot;&gt;&lt;a href=&quot;https://www.flickr.com/photos/vazexqi/114030692/&quot;&gt;Scheme&lt;/a&gt; by vazexqi under CC BY&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;It was weird. I had to come to terms with the peculiar way it specified operations and their arguments in what I was later taught was &lt;em&gt;prefix notation&lt;/em&gt;. We were then taught to do arithmetic, define variables and functions.&lt;/p&gt;
&lt;p&gt;We got far enough into it to make programs that could calculate averages, as well as some school grades our teacher had us do for our final practical exam. But that was pretty much it, and we only spent a semester on it.&lt;/p&gt;
&lt;p&gt;One thing that stuck to me was this perception in my class that Scheme was just this toy language you couldn’t make anything interesting with. Oddly enough, there had been these game apps that appeared to be a part of the Scheme installation. We were happy to be playing them while regarding Scheme as a toy language.&lt;/p&gt;
&lt;p&gt;We had heard about other languages like C, Java from other people. To most of us who were learning programming for the first time, Scheme just wasn’t something suitable for serious, real-world™ programming. I don’t even remember being told it was functional.&lt;/p&gt;
&lt;h1 id=&quot;high-school--uni&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#high-school--uni&quot; aria-label=&quot;high school  uni permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;High School &amp;#x26; Uni&lt;/h1&gt;
&lt;p&gt;They taught us Java in senior high and in college; it had the reputation of being &lt;em&gt;real-world&lt;/em&gt;. I bemoaned having to write ifs, switches and loops repeatedly. I’ve spent more time than I’ll admit pulling hairs over one-off errors that had me worry about the &lt;em&gt;how&lt;/em&gt; more than the &lt;em&gt;what&lt;/em&gt;. It almost felt like it was sheer luck I got the &lt;em&gt;what&lt;/em&gt; right eventually—not very well even then.&lt;/p&gt;
&lt;p&gt;Every class that looked like it represented data had to have &lt;em&gt;getters&lt;/em&gt; and &lt;em&gt;setters&lt;/em&gt; as a hedge for when you might want to &lt;em&gt;do something else&lt;/em&gt; with &lt;em&gt;encapsulated&lt;/em&gt; data. It was tedious. Ever since reading the &lt;a href=&quot;https://domainlanguage.com/ddd/blue-book/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;DDD blue book&lt;/a&gt; after college, I stopped exposing everything. Only the bare minimum needed.&lt;/p&gt;
&lt;figure class=&quot;float-left&quot; style=&quot;width: 300px&quot;&gt;
	&lt;img src=&quot;/media/cs-form.jpg&quot; alt=&quot;Windows Forms C#&quot;&gt;
	&lt;figcaption&gt;Code was shoved into some Form{number}.cs&lt;/figcaption&gt;
	&lt;figcaption class=&quot;attrib&quot;&gt;&lt;a href=&quot;https://www.flickr.com/photos/shokai/3470835562&quot;&gt;C#.NETでForm&lt;/a&gt; by Sho Hashimoto under CC BY&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Soon enough we decided to use C# for projects. We used it as another Java, taking advantage of Visual Studio’s Form Designer for WYSIWYG WinForms development. We ended up shoving all our application logic in our custom GUI classes and writing all application behavior in hundreds up to over a thousand lines of event handler code.&lt;/p&gt;
&lt;p&gt;We weren’t exactly taught modern-day software engineering, mind you. It was all about completing diagrams before you write any code—traditional waterfall. Visual Studio &lt;a href=&quot;http://charlespetzold.com/etc/DoesVisualStudioRotTheMind.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;rotted our minds&lt;/a&gt;, that’s for sure.&lt;/p&gt;
&lt;p&gt;That they were having us build whole applications was a head-scratcher. Never mind we had an “Object-oriented design” course after “Software engineering”. Those lessons would have come in handy in taming the complexity of our thousand-liner event handlers. That said, design patterns are advanced concepts in OOP. It’s one thing to know what they are, it’s another to know how they combine together and which parts should go where.&lt;/p&gt;
&lt;p&gt;In the end, most of our school projects didn’t use design patterns much, if at all.&lt;/p&gt;
&lt;p&gt;In fairness to our school, we did have a “Programming Languages” course. It was valuable how it exposed us to other paradigms. It did mention Haskell, FP, and even logic programming languages like Prolog. Schools should be pushing other paradigms like functional and logic &lt;strong&gt;more&lt;/strong&gt; and &lt;strong&gt;earlier&lt;/strong&gt;. Looking back at how I wasn’t convinced to do FP cements my view FP needs more PR.&lt;/p&gt;
&lt;h2 id=&quot;some-respite-in-sql&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#some-respite-in-sql&quot; aria-label=&quot;some respite in sql permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Some respite in SQL&lt;/h2&gt;
&lt;p&gt;Databases were something else. Learning SQL was eye-opening, revealing a much more intuitive way of gleaning information from mounds of data than just looping over it. This was the feeling I got working through &lt;a href=&quot;https://sqlzoo.net&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;SQL Zoo&lt;/a&gt;. In class, we were taught the Oracle SQL dialect. The Oracle brand reminded me of its namesake in Greek mythology. To quote Wikipedia,&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“…a person or agency considered to provide wise and insightful counsel or prophetic predictions or precognition of the future”.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I even remember my grandma telling me how I should learn Oracle because word around was it was this big-time, high-paying tech thing. Even my grandma was in on it!&lt;/p&gt;
&lt;h2 id=&quot;in-sql-we-trust&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#in-sql-we-trust&quot; aria-label=&quot;in sql we trust permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;In SQL we trust&lt;/h2&gt;
&lt;p&gt;Our GUI applications were merely frontends to our databases backends. Application logic was just front-end logic, meant to ferry SQL statements over to the backend. We were told to use database triggers to implement key domain logic and keep boundaries consistent. It was good enough. It was a testament to how well-suited database systems were for working on data, and how easy it was to build queries that got us exactly what we wanted.&lt;/p&gt;
&lt;p&gt;Why was this the case? I’d credit it to SQL being founded on solid math, along with the expressive power afforded by its declarative model. I’ve since realized SQL and FP had something in common: being declarative.&lt;/p&gt;
&lt;h1 id=&quot;into-the-real-world&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#into-the-real-world&quot; aria-label=&quot;into the real world permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Into the real world&lt;/h1&gt;
&lt;p&gt;PHP and JavaScript were interesting; They were my first run-in with languages with closures, first-class functions and higher-order functions. But the first language where I started using them heavily was C#. Using LINQ in C# was something that dramatically changed how I viewed programming. I hadn’t realized it but it was my first run-in with monads. I was pretty amazed how I got to essentially write queries within the language (LINQ stands for &lt;strong&gt;L&lt;/strong&gt;anguage &lt;strong&gt;IN&lt;/strong&gt;tegrated &lt;strong&gt;Q&lt;/strong&gt;uery after all). It also turned out I could do it with collections!&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;gatsby-resp-image-figure&quot; style=&quot;&quot;&gt;
    &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 675px;&quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 133.4814814814815%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAgP/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgD/2gAMAwEAAhADEAAAAbPSO2ZsTMzN8cTdEnhX/8QAHRAAAgEEAwAAAAAAAAAAAAAAAAECBBESIRATMf/aAAgBAQABBQJMuZCqpCqIuPcRetWjji/U+P/EABcRAAMBAAAAAAAAAAAAAAAAAAABEBH/2gAIAQMBAT8BMYp//8QAFhEAAwAAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/ASv/xAAZEAADAQEBAAAAAAAAAAAAAAAAARAhETL/2gAIAQEABj8C26kdPN1jv//EABwQAAMAAwADAAAAAAAAAAAAAAABERAhMVGBof/aAAgBAQABPyHGtSTaYgQ74hT59DutpDbdejWncVzfSH//2gAMAwEAAgADAAAAEH8QQP/EABcRAQEBAQAAAAAAAAAAAAAAAAABYRH/2gAIAQMBAT8QZKldx//EABcRAQEBAQAAAAAAAAAAAAAAAAARASH/2gAIAQIBAT8QQ3iP/8QAHRABAAMAAwADAAAAAAAAAAAAAQARITFBUWFxkf/aAAgBAQABPxDcAj8kp0NfUscP5M73VJkaho4WnKOn2D6cbNogW8LYMl+ZlZ1NLbYCI0mQoKc7iFtJ/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
        &lt;source
          srcset=&quot;/static/a57b775d66e7ddea3a7e350e7b9e46db/8ac56/winding-road.webp 240w,
/static/a57b775d66e7ddea3a7e350e7b9e46db/d3be9/winding-road.webp 480w,
/static/a57b775d66e7ddea3a7e350e7b9e46db/3bfaf/winding-road.webp 675w&quot;
          sizes=&quot;(max-width: 675px) 100vw, 675px&quot;
          type=&quot;image/webp&quot;
        /&gt;
        &lt;source
          srcset=&quot;/static/a57b775d66e7ddea3a7e350e7b9e46db/09b79/winding-road.jpg 240w,
/static/a57b775d66e7ddea3a7e350e7b9e46db/7cc5e/winding-road.jpg 480w,
/static/a57b775d66e7ddea3a7e350e7b9e46db/512c0/winding-road.jpg 675w&quot;
          sizes=&quot;(max-width: 675px) 100vw, 675px&quot;
          type=&quot;image/jpeg&quot;
        /&gt;
        &lt;img
          class=&quot;gatsby-resp-image-image&quot;
          src=&quot;/static/a57b775d66e7ddea3a7e350e7b9e46db/512c0/winding-road.jpg&quot;
          alt=&quot;My long and winding journey towards FP has been one of the avoidance of pain&quot;
          title=&quot;Winding road&quot;
          loading=&quot;lazy&quot;
          style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        /&gt;
      &lt;/picture&gt;
    &lt;/span&gt;
    &lt;figcaption class=&quot;gatsby-resp-image-figcaption&quot;&gt;My long and winding journey towards FP has been one of the avoidance of pain&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;The more OOP experience I got, the more I realized “good OOP” looked more and more like FP. There’s “composition over inheritance”, “prefer immutability”, and the fact that many design patterns owe their existence to the lack of first-class functions in languages like Java.&lt;/p&gt;
&lt;h2 id=&quot;rediscovering-javascript&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#rediscovering-javascript&quot; aria-label=&quot;rediscovering javascript permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Rediscovering JavaScript&lt;/h2&gt;
&lt;p&gt;I had been using JavaScript for a long time and before I knew it I’ve been using its functional features more and more. Instead of for and while loops, I’ve been using higher-order functions (HOF) in array methods like &lt;code class=&quot;language-text&quot;&gt;map&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;flatMap&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;filter&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;reduce&lt;/code&gt;. I also expanded my usage of interesting HOFs to those in underscore and lodash. The one that tipped me over to the FP side however was a little-known library called &lt;a href=&quot;https://highlandjs.org/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;highland.js&lt;/a&gt;. It was impressive how I could just write a whole Node program as one long stream.&lt;/p&gt;
&lt;p&gt;Something that had been plaguing frontend JavaScript (thanks to AJAX) and Node and for some time was callback hell. It got so bad that I’d sometimes just factor out each layer of a stack of callbacks into its own function. The &lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt; abstraction came along and I was stunned how I could effectively keep indentation in check. Promises were infectious though, use it in one place and soon enough you’re going to have to use it everywhere.&lt;/p&gt;
&lt;p&gt;I didn’t know it then but &lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt; was an &lt;a href=&quot;https://buzzdecafe.github.io/2018/04/10/no-promises-are-not-monads&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;almost monad&lt;/a&gt;. The arrival and widespread adoption of generators and &lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;await&lt;/code&gt; syntax wasn’t going to happen until a few years later.&lt;/p&gt;
&lt;h1 id=&quot;teaching-myself-fp&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#teaching-myself-fp&quot; aria-label=&quot;teaching myself fp permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Teaching myself FP&lt;/h1&gt;
&lt;p&gt;Around 2015, I was sold on FP. I was especially interested in the promises it made, particularly in its suitability for concurrent and parallel programming. I also happened to have been drawn to Groovy in particular because of Bob Martin’s &lt;a href=&quot;https://cleancoders.com/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Clean Code video series&lt;/a&gt; and his endorsement of dynamic programming languages.&lt;/p&gt;
&lt;h2 id=&quot;a-dalliance-with-groovy&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#a-dalliance-with-groovy&quot; aria-label=&quot;a dalliance with groovy permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;A dalliance with Groovy&lt;/h2&gt;
&lt;p&gt;I was flirting with &lt;a href=&quot;http://www.gpars.org/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;GPars&lt;/a&gt; actors and its other concurrency primitives. I tried actors and just didn’t see how they could compose in the way I’ve been getting used to—functionally. Maybe it was just my lack of industry experience but there weren’t too many good examples to go by.&lt;/p&gt;
&lt;p&gt;Googling Groovy often yielded comparisons with some other language called Scala. I was impressed with Groovy’s HOFs and the one-liners but this other statically-typed language seemed to manage to be as expressive and concise as its dynamic counterpart!&lt;/p&gt;
&lt;h2 id=&quot;scala&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#scala&quot; aria-label=&quot;scala permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Scala&lt;/h2&gt;
&lt;p&gt;Some time later I came upon a &lt;a href=&quot;https://www.youtube.com/embed/b6yLwvNSDck&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;video&lt;/a&gt; comparing Node to Play, a web framework written in Scala. I just had to know what the fuss was all about.&lt;/p&gt;
&lt;p&gt;Poring over &lt;a href=&quot;https://booksites.artima.com/programming_in_scala_4ed&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Programming in Scala&lt;/a&gt;, I immediately fell in love with the language. It removed my misgivings about clunky static type systems like Java’s. It showcased data structures and case classes that were immutable &lt;strong&gt;by default&lt;/strong&gt;. It boasted powerful HOFs; a batteries-included (although arcane at times) standard library; a beautiful, terse syntax; and a way to have minimally-intrusive strong and static types thanks to type inference.&lt;/p&gt;
&lt;h3 id=&quot;akka&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#akka&quot; aria-label=&quot;akka permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Akka?&lt;/h3&gt;
&lt;p&gt;Of course, the next step was figuring out how to cash in on FP using Scala. I have to admit I had been mostly dismissive of Akka’s actor model because it wasn’t the model of composability I was getting used to. Later on, I learned of the strength of actors in modeling system boundaries, and its suitability for distributed systems. Indeed, &lt;a href=&quot;https://blog.softwaremill.com/scalaz-8-io-vs-akka-typed-actors-vs-monix-part-1-5672657169e1&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;“Akka is much more than just actors; there’s streaming, persistence and clustering, just to name the three most popular modules.”&lt;/a&gt;, and it has gotten much better at composition.&lt;/p&gt;
&lt;p&gt;Something I’ve been finding out over time however, was a problem with Akka: its reliance on Scala’s problematic built-in &lt;code class=&quot;language-text&quot;&gt;Future&lt;/code&gt;. Before I got around to diving deep into Akka, another book caught my attention.&lt;/p&gt;
&lt;h3 id=&quot;the-red-book-functional-programming-in-scala&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-red-book-functional-programming-in-scala&quot; aria-label=&quot;the red book functional programming in scala permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://www.manning.com/books/functional-programming-in-scala&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;The Red Book (Functional Programming in Scala)&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;This is not an easy book but it is well worth it. Personally, I’ve had to pore over this book 2-3 times over the course of a few months just to &lt;em&gt;get&lt;/em&gt; it. Don’t let the title fool you, the title doesn’t give the impression that it’s advanced material—something I came to realize only 3 years after. But what it had instilled in me would forever change how I saw programming, i.e. what pure FP had to offer. After I felt I had learned enough, the challenge was to start applying what I’ve learned to the real world.&lt;/p&gt;
&lt;h3 id=&quot;scalaz-cats&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#scalaz-cats&quot; aria-label=&quot;scalaz cats permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Scalaz, Cats&lt;/h3&gt;
&lt;p&gt;Scalaz (all of FP?) had this scary reputation but the red book prepared me very well. It was pretty straightforward and pleasant to read Eugene Yokota’s &lt;a href=&quot;http://eed3si9n.com/learning-scalaz/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Learning Scalaz&lt;/a&gt;. I learned it around the point when iteratees were &lt;em&gt;the&lt;/em&gt; abstraction for purely functional stream processing. Another great book on Scalaz, &lt;a href=&quot;https://leanpub.com/fpmortals&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Functional Programming for Mortals&lt;/a&gt;, came out in 2018. I think many functional Scala users will agree it’s easier to go straight to learning Scalaz or Cats than &lt;a href=&quot;#the-red-book-functional-programming-in-scala&quot;&gt;FPiS&lt;/a&gt;. &lt;a href=&quot;https://typelevel.org/cats/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Cats&lt;/a&gt; was a fork of Scalaz that has come into its own as a core library in the vibrant &lt;a href=&quot;https://typelevel.org/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Typelevel ecosystem&lt;/a&gt;. They offer a great selection of libraries for the practical application of pure FP.&lt;/p&gt;
&lt;h3 id=&quot;fp-ddd-and-functional-effects&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#fp-ddd-and-functional-effects&quot; aria-label=&quot;fp ddd and functional effects permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;FP, DDD, and functional effects&lt;/h3&gt;
&lt;p&gt;So far, getting into functional Scala was great and all but I felt there were still a few gaps in my knowledge. How do I do domain modeling? How does the DDD I learned while working in an OOP paradigm translate to FP? I turned to Debashish Ghosh’s &lt;a href=&quot;https://www.manning.com/books/functional-and-reactive-domain-modeling&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Functional and Reactive Domain Modeling&lt;/a&gt;. Great book. It helps bridge the gap between knowing FP and using it in projects.&lt;/p&gt;
&lt;p&gt;Another question I started asking: how was I supposed to go about putting various functional effects together? &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Option&lt;/code&gt; are great. &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; can be pretty handy. All these effects are nice and all but when using them together, it can get pretty hairy—especially when using them to write sequential code. This is because monads don’t compose. Monad transformers, the would-be band-aid to this, aren’t exactly known for their ergonomics and performance. Also, free monads just come with a lot of boilerplate. Not to mention they work better in some domains (think &lt;a href=&quot;http://scala-slick.org/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Slick&lt;/a&gt;, &lt;a href=&quot;https://tpolecat.github.io/doobie/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Doobie&lt;/a&gt;) than others. Over time I felt I had to look at some other ways to do pure FP.&lt;/p&gt;
&lt;h3 id=&quot;eff-and-tagless-final&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#eff-and-tagless-final&quot; aria-label=&quot;eff and tagless final permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Eff and Tagless Final&lt;/h3&gt;
&lt;p&gt;FP can be hard in its own way. Sure, OOP/imperative spaghetti code bases are harder but FP can get pretty verbose and messy. When I was learning &lt;a href=&quot;https://atnos-org.github.io/eff/index.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Eff&lt;/a&gt;, I wrote &lt;a href=&quot;/posts/eff-in-context&quot;&gt;another article&lt;/a&gt; on it in the context of other FP approaches. Touted as an alternative to monad transformers, it offered a better way to put effects together. Granted, the typings can get arcane. It does have a great adoption story in Zalando though. It’s up there among my favorite IO effects in Scala today, along with Monix and ZIO.&lt;/p&gt;
&lt;p&gt;While getting my hands dirty with Functional and Reactive Domain Modeling, I remember chapters went by where the author would replace a domain service’s effect type from &lt;code class=&quot;language-text&quot;&gt;Try&lt;/code&gt;, to &lt;code class=&quot;language-text&quot;&gt;Future&lt;/code&gt;, to &lt;code class=&quot;language-text&quot;&gt;Kleisli&lt;/code&gt; (which we write the &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; monad in terms of), and some others I may have missed. To me it begged the question: what if I could just parameterize my domain logic over some &lt;code class=&quot;language-text&quot;&gt;F[_]&lt;/code&gt; that I could bind to as late as possible? I experimented with the idea and eventually found out it was a part of a thing that had a name: tagless final. My current take on it is while there are benefits to using the principle of least power which tagless final allows you to write your domain logic with, the typeclasses one uses had better come with some laws. Then again, I don’t have any professional experience using tagless final and neither have I used it in production for some non-trivial project so my opinion could still very well change. &lt;/p&gt;
&lt;p&gt;Not related to programming or anything technical, but I fell into a rut around this time in my FP journey. I hadn’t been productive and I often found myself drained and not being able to code. Just opening my projects was taxing.&lt;/p&gt;
&lt;p&gt;I had read about ZIO around this time from Mateus Kubuszok’s excellent article on &lt;a href=&quot;https://kubuszok.com/2019/io-monad-which-why-and-how/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;IO monads&lt;/a&gt;. It got me curious enough to check ZIO out.&lt;/p&gt;
&lt;h3 id=&quot;zio&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#zio&quot; aria-label=&quot;zio permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://zio.dev&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;ZIO&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;What can I say? I was impressed. It has gotten to be my favorite functional effect right now. It has been a pleasure coding in it. I love that you can do pretty much anything in ZIO without having to know what a Coyoneda is (I still don’t know).&lt;/p&gt;
&lt;p&gt;Don’t get me wrong, it helps to know typeclasses. It helps to know stuff like monoids, functors, applicatives, monads, traversables, and foldables. But there’s something to be said about just using those typeclasses implicitly in your code (not Scala implicits) or as John De Goes would put it, “stealth FP”.&lt;/p&gt;
&lt;p&gt;FP can be verbose at times, like an animé character calling out their every move. ZIO is the character that bucks the trend and just does it.&lt;/p&gt;
&lt;p&gt;Overall, I believe it’s a perfect fit for Scala’s language features with just the amount of type information—all the while making practical FP very accessible.&lt;/p&gt;
&lt;h3 id=&quot;looking-forward&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#looking-forward&quot; aria-label=&quot;looking forward permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Looking Forward&lt;/h3&gt;
&lt;figure class=&quot;float-right&quot; &gt;
  &lt;img src=&quot;/media/scala-logo.jpg&quot; /&gt;
  &lt;figcaption&gt;I mean come on, that&apos;s such a cool logo&lt;/figcaption&gt;
  &lt;figcaption class=&quot;attrib&quot;&gt;
    &lt;a href=&quot;https://www.flickr.com/photos/99087984@N00/5247567841&quot;&gt;&quot;scala-lang-logo&quot;&lt;/a&gt; by alejandrocrosa &lt;br/&gt;under CC BY-NC-SA 2.0
  &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;A &lt;a href=&quot;https://twitter.com/search?q=%23scalaThankYou&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;#ScalaThankYou&lt;/a&gt; is in order here. I love Scala. I love doing FP in it. It has such a great ecosystem and I’ve come to love the distinct, yet compatible ecosystems that have sprung up around it. I love Akka, Scalaz, Typelevel, and ZIO and all the other wonderful things people have built. The future is looking brighter with the promise of Scala 3. It’s growing past its JVM beginnings: &lt;a href=&quot;https://www.scala-js.org/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Scala JS&lt;/a&gt; 1.0.0 is &lt;a href=&quot;https://www.scala-js.org/news/2019/12/13/announcing-scalajs-1.0.0-RC2/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;right around the corner&lt;/a&gt; and Scala Native is looking better and looks pretty active.&lt;/p&gt;
&lt;p&gt;I’m excited to see what amazing stuff its ecosystems come up with next. Maybe Scala will help make FP the default paradigm for writing applications?&lt;/p&gt;
&lt;h1 id=&quot;next-steps&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#next-steps&quot; aria-label=&quot;next steps permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Next Steps&lt;/h1&gt;
&lt;p&gt;FP is a vast domain in itself. It’s a great default paradigm for most modern applications. There is a lot of FP to do in various amounts in languages that will allow some of it. Haskell is certainly in my backlog of stuff to learn. Hopefully it gets the mind share it deserves.&lt;/p&gt;
&lt;p&gt;However, there’s still the matter of adoption. To this end I’m looking to continue my FP journey by sharing what I’ve learned so far with people in my country. I couldn’t turn up any metrics, but my hunch is that the development culture here is still pretty much dominated by procedural and OOP, with languages such as PHP and JavaScript. Java and C# would score higher in corporate settings.&lt;/p&gt;
&lt;p&gt;I’m currently working on video and web content in my mother tongue, Cebuano, in a bid to increase the adoption of FP here. I don’t think the English-speaking world needs it as much as there’s already tons of content out there, but I might as well localize into English too for completeness. &lt;/p&gt;
&lt;p&gt;All that said, &lt;a href=&quot;https://www.linkedin.com/in/zach-albia&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;I could really use a job&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I’m passionate about making stuff in functional Scala.&lt;/p&gt;
&lt;p&gt;I could use some help in my journey, maybe you could use my help in yours. &lt;/p&gt;</content:encoded></item><item><title><![CDATA[Eff in Context]]></title><description><![CDATA[Looking at Scala's version of the eff monad in context in comparison with other functional approaches]]></description><link>https://zach-albia.github.io/posts/eff-in-context</link><guid isPermaLink="false">https://zach-albia.github.io/posts/eff-in-context</guid><pubDate>Tue, 31 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Learning how to use &lt;a href=&quot;https://github.com/atnos-org/eff&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Eff in Scala&lt;/a&gt;, let alone learning how it works on the inside, is quite the challenge for me and I believe for many people too. I feel that there’s quite the chasm from running a few easy examples to putting together a full app using Eff.&lt;/p&gt;
&lt;h2 id=&quot;contents&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#contents&quot; aria-label=&quot;contents permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Contents&lt;/h2&gt;
&lt;div class=&quot;toc&quot;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;#many-ways-to-say-hello&quot;&gt;Many ways to say Hello&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#the-simplest-way&quot;&gt;The simplest way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-testable-way&quot;&gt;The &lt;em&gt;testable&lt;/em&gt; way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-reader-way&quot;&gt;The Reader way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-reader-writer-way&quot;&gt;The &lt;em&gt;Reader-Writer&lt;/em&gt; way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-reader-writer-either-way&quot;&gt;The &lt;em&gt;Reader-Writer-Either&lt;/em&gt; Way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-monad-transformer-way&quot;&gt;The &lt;em&gt;Monad Transformer&lt;/em&gt; Way&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-eff-monad-way&quot;&gt;The &lt;em&gt;Eff Monad&lt;/em&gt; Way&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;However, Eff has a great amount of documentation for the initiated FP user in Scala. In fact, there’s even a set of exercises in &lt;a href=&quot;https://github.com/benhutchison/GettingWorkDoneWithExtensibleEffects/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;&lt;em&gt;“Getting Work Done With Extensible Effects”&lt;/em&gt;&lt;/a&gt; that guide you in a methodical way towards understanding how you might use Eff in a real, non-trivial app. There’s even &lt;a href=&quot;https://vimeo.com/channels/flatmap2016/165927840&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;a great presentation&lt;/a&gt; about a practical way to use Eff in bigger projects, though I’ve yet to see the usage of the overall framework described in it in a sample application. I hope there’s one out there and I hope I just missed it. Or maybe it’s not needed at all.&lt;/p&gt;
&lt;p&gt;That said, I think there’s still a part of that chasm that needs to be covered. It’s somewhere in between someone starting out with FP in Scala and the aforementioned exercises by Ben Hutchinson. I think there’s some value in going back to the simplest problems and seeing what Eff looks like there.&lt;/p&gt;
&lt;p&gt;I’m planning to have this series span the first set of adriannn’s &lt;a href=&quot;https://adriann.github.io/programming_problems.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Simple Programming Problems&lt;/a&gt;, namely the &lt;em&gt;Elementary Problems&lt;/em&gt;. &lt;a href=&quot;https://github.com/zach-albia/learning-eff&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;This series’ code&lt;/a&gt; is available on Github. We kick things off with our first problem:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Write a program that prints ‘Hello World’ to the screen.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;many-ways-to-say-hello&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#many-ways-to-say-hello&quot; aria-label=&quot;many ways to say hello permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Many ways to say Hello&lt;/h1&gt;
&lt;h2 id=&quot;the-simplest-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-simplest-way&quot; aria-label=&quot;the simplest way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The simplest way&lt;/h2&gt;
&lt;p&gt;Our first jab at the problem begins with the simplest possible example that we’re taught when we first learn to program in any language. Our first problem happens to be Scala’s Hello World:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass01 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s simple, but inflexible. You can only ever print to the console here. Period. What if we wanted to print &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt; to a file? Also, how do we know it works? We run it, and it prints &lt;code class=&quot;language-text&quot;&gt;Hello World&lt;/code&gt; to the console. But we did have to look at the characters it prints out. And we did have to make sure &lt;em&gt;every single character&lt;/em&gt; lines up to make the string &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt;. We aren’t exactly perfect at reading either, and our eyes can trip and think we’re reading the right string when we’re not!&lt;/p&gt;
&lt;p&gt;If it can happen to us in a simple “Hello World”, imagine what would happen if we had to do it for any bigger program. We say we &lt;strong&gt;cannot test&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;. It’s opaque to any testing effort unless we go to great lengths just to read the output on the console itself. Let’s see if we can test one of the simplest programs ever.&lt;/p&gt;
&lt;h2 id=&quot;the-testable-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-testable-way&quot; aria-label=&quot;the testable way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;testable&lt;/em&gt; way&lt;/h2&gt;
&lt;p&gt;At the heart of software development is getting things done &lt;em&gt;automatically&lt;/em&gt;. That includes testing. We have to restructure our tiny Hello World app so we can run a test:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;to see if our program compiles,&lt;/li&gt;
&lt;li&gt;to see if it works as expected without having to look at our program’s console output, and&lt;/li&gt;
&lt;li&gt;to be able to automatically do both 1 &amp;#x26; 2 repeatedly.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Here is one way to refactor our code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass02 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; defaultPrintln&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Predef&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;defaultPrintln&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;println&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; is now totally &lt;em&gt;divorced&lt;/em&gt; from the concept of the console. We might as well write &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt; in crop circles, given the right &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;. More practically, now we can write code to test &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Prob01Pass01&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scalatest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; Prob01Spec &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; FlatSpec &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Matchers &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; mockPrintln&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; _ should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token string&quot;&gt;&quot;our second pass at printHelloWorld&quot;&lt;/span&gt; should
      &lt;span class=&quot;token string&quot;&gt;&quot;print hello world to a println function&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Prob01Pass02&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_ should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our test code &lt;em&gt;intercepts&lt;/em&gt; what’s passed to our function. This allows us to automatically confirm that, for whatever way we can print &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; will receive &lt;em&gt;exactly&lt;/em&gt; the string &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt; and &lt;em&gt;nothing else&lt;/em&gt;.&lt;/p&gt;
&lt;h2 id=&quot;the-reader-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-reader-way&quot; aria-label=&quot;the reader way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The Reader way&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; is a function that takes a &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; function and runs it on &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt;, giving back &lt;code class=&quot;language-text&quot;&gt;Unit&lt;/code&gt;. Reader is just an effect in the form of a function taking one parameter which yields our value, the return value. Let’s look at our testable code in terms of Reader:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Reader

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass03 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; defaultPrintln&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Predef&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld

    &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
    program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;defaultPrintln&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; printHelloWorld&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Reader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; println &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our code is very similar to our second pass. Note that we only had to change a little bit of code Since &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; and a function with one parameter, namely &lt;code class=&quot;language-text&quot;&gt;Function1[A, B]&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;A =&amp;gt; B&lt;/code&gt; in Scala, are practically one and the same. In our usage of &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; here, we mean it to &lt;em&gt;delay reading or asking for&lt;/em&gt;  a &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;  function in order to &lt;em&gt;return&lt;/em&gt; &lt;code class=&quot;language-text&quot;&gt;Unit&lt;/code&gt;, i.e. to make some side effect(s). I think “Reader” is a weird name for it. It’d probably make more sense as the “Context”, “Config” or “Dependency”. But what do I know?&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; also allows us to write tests:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;our third pass at printHelloWorld&quot;&lt;/span&gt; should
    &lt;span class=&quot;token string&quot;&gt;&quot;be a flexible hello world program&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Prob01Pass03&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld

  program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_ should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By using &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; , in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt; we end up with a pure &lt;em&gt;description&lt;/em&gt; of our “Hello World” program in &lt;code class=&quot;language-text&quot;&gt;program&lt;/code&gt;. A pure program that we can interpret, or &lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt; any way we want.&lt;/p&gt;
&lt;p&gt;It’s pure in the sense that we can call &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; any number of times and it won’t have any side effects, and will &lt;em&gt;always&lt;/em&gt; return the same program. I’ve read a lot of material with the idea that &lt;em&gt;functional programs are descriptions of programs that you run&lt;/em&gt;. This looks like it fits the bill.&lt;/p&gt;
&lt;p&gt;We can interpret our program in another way with the use of a &lt;em&gt;“fake”&lt;/em&gt; or a &lt;em&gt;“mock”&lt;/em&gt; &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;—one that just checks if it got passed &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt;. We could even interpret &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; to print the line to a file, or write a smoke message in the sky with an autonomous drone given the right &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; function.&lt;/p&gt;
&lt;p&gt;What does Reader buy us? There is some extra cognitive overhead here for sure. We’ve had to learn Reader when we could have just stuck to our second pass by just passing functions. We’ve gained &lt;em&gt;the flexibility and the concept&lt;/em&gt; of a pure program, one that could be interpreted in many ways, one of which is useful for testing. What else can we gain?&lt;/p&gt;
&lt;h2 id=&quot;the-reader-writer-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-reader-writer-way&quot; aria-label=&quot;the reader writer way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;Reader-Writer&lt;/em&gt; way&lt;/h2&gt;
&lt;p&gt;Say, for our fourth pass, we wanted to know how fast “Hello World” runs on our computer. The simplest, non-testable way looks something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass04 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;currentTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; time &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;currentTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $time ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our problem with this code is that it doesn’t easily allow us to change &lt;em&gt;how&lt;/em&gt; we print “Hello World”, as well as &lt;em&gt;how&lt;/em&gt; we read the time. &lt;code class=&quot;language-text&quot;&gt;System.getCurrentTimeMillis&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; here are impure functions. &lt;code class=&quot;language-text&quot;&gt;System.getCurrentTimeMillis&lt;/code&gt; observes the side effect of passing time while &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; has the side effect of writing to a console. Consequently, besides testing Hello World, we can’t test if it’s logging the right amount of time.&lt;/p&gt;
&lt;p&gt;Let’s make an &lt;code class=&quot;language-text&quot;&gt;AppConfig&lt;/code&gt; trait and give it the default console and system time version that we can use in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;trait&lt;/span&gt; AppConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token annotation punctuation&quot;&gt;@throws&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;classOf&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Exception&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; startTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; endTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; AppConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AppConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; AppConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Predef&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; startTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;currentTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; endTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;currentTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that we’ve declared that our &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; can fail. This is due to &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; being flexible enough for this to happen. Now that we have &lt;code class=&quot;language-text&quot;&gt;AppConfig&lt;/code&gt; nailed down, let’s see what we can do with &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;implicits&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass05 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld

    &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeElapsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $timeElapsed ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; printHelloWorld&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Reader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; appCfg &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Looking at &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; is run twice. That’s because our program now has &lt;em&gt;two&lt;/em&gt; effects, &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt;. Our third pass only had &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; so we’ve only had to call &lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt; once. In FP, pure programs like &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; will be run or &lt;em&gt;interpreted&lt;/em&gt; as many times as it has effects. Once we &lt;em&gt;interpret&lt;/em&gt; all those effects, we end up with the output of our pure program, in this case, a &lt;code class=&quot;language-text&quot;&gt;(Long, Unit)&lt;/code&gt; tuple, the first part of which contains our &lt;code class=&quot;language-text&quot;&gt;timeElapsed&lt;/code&gt; in milliseconds.&lt;/p&gt;
&lt;p&gt;With &lt;code class=&quot;language-text&quot;&gt;AppConfig&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt;, we’ve decoupled our code from the console and the system clock. Note that we’ve had to manually &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; our &lt;code class=&quot;language-text&quot;&gt;timeElapsed&lt;/code&gt; report in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;, since the second &lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt; produces a pure log of &lt;code class=&quot;language-text&quot;&gt;timeElapsed&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;With this, we can write a test for our fifth pass that checks both printing Hello World and logging the time.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; MockAppConfig &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; AppConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; s should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; startTime&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; endTime&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token string&quot;&gt;&quot;our fifth pass at printHelloWorld&quot;&lt;/span&gt; should
    &lt;span class=&quot;token string&quot;&gt;&quot;be a flexible, timed hello world program&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Prob01Pass05&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeElapsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockAppConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run
  timeElapsed should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s take a closer look at our &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; program itself.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; printHelloWorld&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  Reader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; appCfg &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We have a stack of two effects, Reader &amp;#x26; Writer. Our &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; needs access to &lt;code class=&quot;language-text&quot;&gt;appCfg&lt;/code&gt; to log the time, which means &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; has to be on the top of our effect stack. Note how we’ve had to manually stack our &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; program inside our &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt;. Though we did also gain the ability for our computation (printing Hello World, mind you), to have multiple effects.&lt;/p&gt;
&lt;p&gt;If we had to stack more effects, our pure program code would get more and more unwieldy and shift further and further to the right. To illustrate this, let’s have a go at adding error handling to our stack.&lt;/p&gt;
&lt;h2 id=&quot;the-reader-writer-either-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-reader-writer-either-way&quot; aria-label=&quot;the reader writer either way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;Reader-Writer-Either&lt;/em&gt; Way&lt;/h2&gt;
&lt;p&gt;Our &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; can throw an exception, as declared in &lt;code class=&quot;language-text&quot;&gt;AppConfig&lt;/code&gt;. After all, we could have our pure program tell a rover on Mars to print “Hello World” on Martian sand, again given the right &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;function. We could very easily lose our connection to the rover! As programmers, we have to be prepared for this scenario. Let’s add error-handling to our stack.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;implicits&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass06 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld

    &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeElapsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run
    result &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Hello world failed: $e&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _       &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $timeElapsed ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; ReaderWriterEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; printHelloWorld&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ReaderWriterEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    Reader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; appCfg &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        e &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; e&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Exception &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appCfg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; e
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;, after we &lt;em&gt;run&lt;/em&gt; or &lt;em&gt;remove a layer&lt;/em&gt; from the pure program twice, we have one last layer in error handling. We have to handle any errors that might have occurred during the course of its execution.&lt;/p&gt;
&lt;p&gt;Our hand-rolled &lt;code class=&quot;language-text&quot;&gt;ReaderWriterEither[A]&lt;/code&gt; stack now contains &lt;code class=&quot;language-text&quot;&gt;Reader[AppConfig, ?]&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Writer[Long, ?]&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Either[Throwable, ?]&lt;/code&gt;. Note how we’ve had to have &lt;em&gt;yet another level of indentation&lt;/em&gt; just to support error handling. &lt;/p&gt;
&lt;p&gt;A test for this code looks like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; MockUnreachableRover &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; AppConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; exception &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; Exception&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Couldn&apos;t connect to Mars!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; exception &lt;span class=&quot;token comment&quot;&gt;// this matters&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; startTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// these values&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; endTimeMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;   &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// don&apos;t matter&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token string&quot;&gt;&quot;our sixth pass at printHelloWorld&quot;&lt;/span&gt; should
    &lt;span class=&quot;token string&quot;&gt;&quot;be a flexible, timed, resilient hello world program&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Prob01Pass06&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeElapsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockAppConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run
  timeElapsed should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockUnreachableRover&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run
  result should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockUnreachableRover&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our tests say it all. We now have a Hello World program that’s flexible (allowing any &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;), timed (in ms), and resilient (by catching errors). By now we should be able to say it’s all worth it. If we know how to imbue our humble Hello World program with these qualities, we now stand a chance at ensuring all our functional programs have the same qualities. But our &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; already looks rather &lt;em&gt;tedious&lt;/em&gt;. Scale it to any bigger program and it becomes a maintenance and readability nightmare. There has to be a better way to write functional programs. This calls for a more suitable abstraction.&lt;/p&gt;
&lt;h2 id=&quot;the-monad-transformer-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-monad-transformer-way&quot; aria-label=&quot;the monad transformer way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;Monad Transformer&lt;/em&gt; Way&lt;/h2&gt;
&lt;p&gt;One way is to use monad transformers to flatten our for-comprehension:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;implicits&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ReaderT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; WriterT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass07 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld

    &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
    program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                   &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Hello world failed: $e&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeElapsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
        println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $timeElapsed ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; EitherThrowable&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; WriterLongEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; WriterT&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;EitherThrowable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; ReaderWriterEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ReaderT&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;WriterLongEither&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; printHelloWorld&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ReaderWriterEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      appConfig &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; ask&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;WriterLongEither&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AppConfig&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      _         &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; logTime&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      either    &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; ReaderT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lift&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;WriterLongEither&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                     WriterT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lift&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;EitherThrowable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                       &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                         Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                       &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; e&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Throwable &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
                         Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                       &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                     &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      _         &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; logTime&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTimeMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; either

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; logTime&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ReaderWriterEither&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    _ &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; ReaderT&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lift&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;WriterLongEither&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This was a &lt;strong&gt;bitch&lt;/strong&gt; to write, and it’s as clean as I could get it with my limited knowledge of &lt;code class=&quot;language-text&quot;&gt;cats&lt;/code&gt;. I’m pretty sure there’s a way more compact way to write this that involves &lt;code class=&quot;language-text&quot;&gt;cats.EitherT&lt;/code&gt;. The &lt;code class=&quot;language-text&quot;&gt;cats&lt;/code&gt; library’s implicits here mean that anytime we have to use &lt;code class=&quot;language-text&quot;&gt;ReaderT&lt;/code&gt;’s functions &lt;code class=&quot;language-text&quot;&gt;ask&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;lift&lt;/code&gt;, we’ve had to specify exactly what it is we’re stacking a &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; on top of. Otherwise, we get all sorts of nasty compilation errors.&lt;/p&gt;
&lt;p&gt;It is somewhat of an improvement though, in that we’re able to specify our application logic in &lt;em&gt;only one layer&lt;/em&gt; of a for-comprehension. It’s the lifting part that stings. Stacking together three effects doesn’t seem to get us the concise code that we want.&lt;/p&gt;
&lt;p&gt;Our test code is fairly trivial and similar to the last one:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;our seventh pass monad transformers printHelloWorld&quot;&lt;/span&gt; should
  &lt;span class=&quot;token string&quot;&gt;&quot;be a flexible, timed, resilient hello world program&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Prob01Pass07&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld

  program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockAppConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  program&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockUnreachableRover&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockUnreachableRover&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;the-eff-monad-way&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-eff-monad-way&quot; aria-label=&quot;the eff monad way permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The &lt;em&gt;Eff Monad&lt;/em&gt; Way&lt;/h2&gt;
&lt;p&gt;Let’s let the code do the talking this time:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;cats&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;atnos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eff&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;atnos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eff&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;atnos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eff&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;syntax&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob01Pass08 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Stack &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Fx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fx3&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Stack&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; result&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      program
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runReader&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runWriterUnsafe&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runEither
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run

    result &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Our program&apos;s result is a side effect that can fail.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
        println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Hello world failed: $e&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; _appCfg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; R
  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; _timeReport&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; R

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _appCfg &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _timeReport &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _throwableEither&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Eff&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    appConfig &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; ask
    start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTimeMillis
    either    &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; catchNonFatalThrowable&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    durationInMs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTimeMillis &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start
    _         &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $durationInMs ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; either
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s embarrassing how stupidly simple &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; looks compared to passes 6 and 7. Let’s break each part down to see how it all works.&lt;/p&gt;
&lt;p&gt;We define our program’s effect stack using a type declaration as shown below.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Stack &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Fx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fx3&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Fx.fx3&lt;/code&gt; means we have three effects as shown. Eff supports up to 12 effects stacked with &lt;code class=&quot;language-text&quot;&gt;Fx.fx12&lt;/code&gt;. Why the seemingly arbitrary selection of 12? I don’t know. Probably something to do with the Scala compiler? At any rate, we’ll need this later for &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt; to know how to interpret our pure program. We also need &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; to declare what sort of effects it needs. Before we do that, we make a couple of type declarations:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; _appCfg&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Reader&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; R
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; _timeReport&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Writer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; R&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We need these since &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; both accept two type parameters. Now we use them in our &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; signature:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _appCfg &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _timeReport &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; _throwableEither&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Eff&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  appConfig &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; ask
  start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startTimeMillis
  either    &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; catchNonFatalThrowable&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  durationInMs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; appConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;endTimeMillis &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start
  _         &lt;span class=&quot;token keyword&quot;&gt;&amp;lt;-&lt;/span&gt; tell&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in $durationInMs ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; either&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s almost as if someone put together &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Either&lt;/code&gt; and combined them together into one monad. We simply &lt;code class=&quot;language-text&quot;&gt;ask&lt;/code&gt; the &lt;code class=&quot;language-text&quot;&gt;Reader&lt;/code&gt; for the config, catch &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; errors with &lt;code class=&quot;language-text&quot;&gt;catchNonFatalThrowable&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;tell&lt;/code&gt; &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; to write our running time to some log.&lt;/p&gt;
&lt;p&gt;Finally, let’s go take a look at &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Stack&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// at the end of the world&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; result&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Throwable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    program
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runReader&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AppConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runWriterUnsafe&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;println&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runEither
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run

  result &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Our program&apos;s result is a side effect that can fail.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
      println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token string&quot;&gt;&quot;Hello world failed: $e&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We first let &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; know it runs under a stack of effects as specified earlier in our &lt;code class=&quot;language-text&quot;&gt;Stack&lt;/code&gt; type. At the end of the world, we run our effects exactly in the order shown above. Remember, we need to &lt;code class=&quot;language-text&quot;&gt;runReader&lt;/code&gt; before &lt;code class=&quot;language-text&quot;&gt;runWriterUnsafe&lt;/code&gt; because our usage of the &lt;code class=&quot;language-text&quot;&gt;Writer&lt;/code&gt; effect in &lt;code class=&quot;language-text&quot;&gt;printHelloWorld&lt;/code&gt; depends on there being an &lt;code class=&quot;language-text&quot;&gt;AppConfig&lt;/code&gt;, i.e. it needs to get the current time to write &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt;’s running time.&lt;/p&gt;
&lt;p&gt;Note that &lt;code class=&quot;language-text&quot;&gt;runWriterUnsafe&lt;/code&gt; means we can just write our logs in a function with side effects, e.g. &lt;code class=&quot;language-text&quot;&gt;println&lt;/code&gt; to console. You can choose to log this anywhere. Very handy when you have to log a lot of stuff and you don’t want your logs to eat up all your RAM like Google Chrome does. When we &lt;code class=&quot;language-text&quot;&gt;runEither&lt;/code&gt;, we’re left with only one effect, &lt;code class=&quot;language-text&quot;&gt;Eff&lt;/code&gt;. You can think of &lt;code class=&quot;language-text&quot;&gt;Eff&lt;/code&gt; as an effect that combines other effects. We finally get &lt;code class=&quot;language-text&quot;&gt;result&lt;/code&gt; with the last &lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Our final act in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt; is handling any errors that might have occurred while trying to print &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hello World&amp;quot;&lt;/code&gt;. &lt;code class=&quot;language-text&quot;&gt;e&lt;/code&gt; in &lt;code class=&quot;language-text&quot;&gt;Left(e)&lt;/code&gt; contains our possible error while &lt;code class=&quot;language-text&quot;&gt;Right&lt;/code&gt; only contains &lt;code class=&quot;language-text&quot;&gt;Unit&lt;/code&gt;, which we can just ignore.&lt;/p&gt;
&lt;p&gt;Looking at &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;, we get the notion that the entire goal of our program is to produce a side effect, which can fail non-fatally.&lt;/p&gt;
&lt;p&gt;How do we test our Eff program? We just interpret it a different way.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;our eighth pass printHelloWorld Eff monad program&quot;&lt;/span&gt; should
  &lt;span class=&quot;token string&quot;&gt;&quot;be flexible, timed, and resilient&quot;&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; program &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Prob01Pass08&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;printHelloWorld&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Prob01Pass08&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Stack&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; runningMock&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AppConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; MockAppConfig
  &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; failingMock&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AppConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; MockUnreachableRover

  program
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runReader&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runningMock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runWriter
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runEither
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; List&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Ran hello world in 2 ms.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  program
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runReader&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;failingMock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runWriter
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runEither
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run should be &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MockUnreachableRover&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exception&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;conclusion&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;FP can be difficult without the proper abstractions. Even Hello World can get unwieldy. That isn’t to say our FP versions are invariably harder than procedural code or “mainstream” OOP equivalents. Indeed these versions can yield even more difficult, opaque code.&lt;/p&gt;
&lt;p&gt;Our pure programs, however, are highly composable, easier to reason about, and can very easily be made asynchronous, concurrent, and parallel just by adding some &lt;code class=&quot;language-text&quot;&gt;Task&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;Future&lt;/code&gt; effect on the stack and in our pure program’s code. It’s just not as easy to do the same in procedural/OOP code. To see this in action, if this article has helped you understand the whole point of the Eff monad, I strongly suggest you move on to working on the excellent exercises in Ben Hutchinson’s &lt;a href=&quot;https://github.com/benhutchison/GettingWorkDoneWithExtensibleEffects/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;&lt;em&gt;“Getting Work Done With Extensible Effects”&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are two other ways to express our stack that I didn’t include here for lack of time. One way is with the free monad and the other is by rolling out your own &lt;code class=&quot;language-text&quot;&gt;ReaderWriterEither[R, T, L, A]&lt;/code&gt; type which effectively lets you have the same level of abstraction as with Eff. I leave these two as exercises for the reader.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Using Refined Types in Scala]]></title><description><![CDATA[Refined types are pretty cool for domain modeling it turns out]]></description><link>https://zach-albia.github.io/posts/using-refined-types-in-scala</link><guid isPermaLink="false">https://zach-albia.github.io/posts/using-refined-types-in-scala</guid><pubDate>Sat, 21 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/fthomas/refined&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Refined&lt;/a&gt; has some practical, useful ideas. There are obvious, clear benefits to domain modeling with refined types. Learning to use the library and getting used to it does have some overhead though, as with any new thing. We’ll be getting into the nitty-gritty of that overhead as I learn the library.&lt;/p&gt;
&lt;p&gt;To have something to base this series on, I’ll work on &lt;code class=&quot;language-text&quot;&gt;adriann&lt;/code&gt;’s &lt;a href=&quot;https://adriann.github.io/programming_problems.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Simple Programming Problems&lt;/a&gt;, starting with Elementary Problem 3. We’re skipping 1 and 2 because they’re trivial and don’t benefit from refined types, anyway.&lt;/p&gt;
&lt;p&gt;Here’s the problem statement:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;Modify the previous program such that only the users Alice and Bob are greeted with their names.&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;And here’s a solution to Problem 3:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;scala&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StdIn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob3 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; s&lt;span class=&quot;token string&quot;&gt;&quot;Hello, $name!&quot;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Go away!&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So we’re reading a line, making a greeting out of the name the user enters, and printing that greeting to the console. Our greeting can be polite, if your name’s either &lt;em&gt;Alice&lt;/em&gt; or &lt;em&gt;Bob&lt;/em&gt;. We changed the problem a bit by being a bit standoffish to anyone with any other name.&lt;/p&gt;
&lt;p&gt;What if we we’re given an empty &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt;? It’d be awkward to say &lt;code class=&quot;language-text&quot;&gt;&amp;quot;Go away, !&amp;quot;&lt;/code&gt;. Like stuttering, but in writing. Let’s say we don’t ever want an empty &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt; for &lt;code class=&quot;language-text&quot;&gt;greet&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Enter refined types.&lt;/p&gt;
&lt;p&gt;First off, we could fix it in a lot of ways, but there’s already &lt;a href=&quot;https://beyondthelines.net/programming/refined-types/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;a good writeup&lt;/a&gt; on why refined types are, at least IMO, one of the better ways. So let’s use them here.&lt;/p&gt;
&lt;p&gt;First, we change our &lt;code class=&quot;language-text&quot;&gt;greet&lt;/code&gt;’s signature:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; Refined NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Already, we run into a problem in &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;, because &lt;code class=&quot;language-text&quot;&gt;readLine&lt;/code&gt; returns a &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt;, while &lt;code class=&quot;language-text&quot;&gt;greet&lt;/code&gt; now wants a &lt;code class=&quot;language-text&quot;&gt;NonEmptyString&lt;/code&gt;. While we’re at it, let’s add an alias for brevity:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; NonEmptyString &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; Refined NonEmpty&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We also have another, more pernicious problem in that we’re comparing the equality of a &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt; to a &lt;code class=&quot;language-text&quot;&gt;NonEmptyString&lt;/code&gt;, which is a patently bad idea. The culprit here is &lt;code class=&quot;language-text&quot;&gt;name == &amp;quot;Alice&amp;quot; || name == &amp;quot;Bob&amp;quot;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;At this point, I think it’s a good time to use Scalaz’s type-safe &lt;code class=&quot;language-text&quot;&gt;Equal&lt;/code&gt;. Let’s change the expression to &lt;code class=&quot;language-text&quot;&gt;name === &amp;quot;Alice&amp;quot; || name === &amp;quot;Bob&amp;quot;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now we have three errors, namely:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; is not a member of eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Refined&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;collection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;     &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; s&lt;span class=&quot;token string&quot;&gt;&quot;Hello, $name!&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;              &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; is not a member of eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Refined&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;collection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;     &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; s&lt;span class=&quot;token string&quot;&gt;&quot;Hello, $name!&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;                                  &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; mismatch&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;  found   &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;  required&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Refined&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;collection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is a strictly better outcome than trying to compare the name read from user input, only for our conditional to always come up &lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt; because they aren’t the same type! So how do we make our Equal typeclass work for refined types?&lt;/p&gt;
&lt;p&gt;It turns out &lt;code class=&quot;language-text&quot;&gt;refined&lt;/code&gt; has support for &lt;code class=&quot;language-text&quot;&gt;Equal&lt;/code&gt; so let’s go with that and &lt;code class=&quot;language-text&quot;&gt;import eu.timepit.refined.scalaz._&lt;/code&gt;. Note that we’ve had to add the dependency in &lt;code class=&quot;language-text&quot;&gt;build.sbt&lt;/code&gt; with: &lt;code class=&quot;language-text&quot;&gt;libraryDependencies += &amp;quot;eu.timepit&amp;quot; %% &amp;quot;refined-scalaz&amp;quot; % &amp;quot;0.8.4&amp;quot;&lt;/code&gt;. Refined also provides a way to automatically &lt;em&gt;lift&lt;/em&gt; literals into refined types, so let’s use them with &lt;code class=&quot;language-text&quot;&gt;import eu.timepit.refined.auto._&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now that we’ve resolved the errors in our conditional, we are left with the following new error:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; compile&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;time refinement only works &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; literals
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;     println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;                           &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And for good reason. There isn’t a way for our compiler to know if our user is entering a &lt;code class=&quot;language-text&quot;&gt;NonEmptyString&lt;/code&gt;! The user can choose &lt;em&gt;not&lt;/em&gt; to enter anything after all. With that in mind, we have to resolve the type &lt;strong&gt;at runtime&lt;/strong&gt;. To do this, we &lt;em&gt;refine&lt;/em&gt; our user input at runtime.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refineV&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; refinedUserInput&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Either&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Refined&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; 
      refineV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When refining values at runtime, we end up with an &lt;code class=&quot;language-text&quot;&gt;Either[String, Refined[_, _]]&lt;/code&gt;. At this point, we know we’ve reached the edge of our program. We &lt;em&gt;have&lt;/em&gt; to rewrite &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  refineV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Left&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// what to do here?&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By using refined types, we are &lt;em&gt;eventually forced&lt;/em&gt; to deal with the case where our user enters an invalid name. Let’s say we decide to just tell the user that they didn’t enter a name. We can do that here.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  refineV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You didn&apos;t enter a name!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can even ask the user again, with recursion.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
  refineV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
      println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You didn&apos;t enter a name!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here’s the whole code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scala&quot;&gt;&lt;pre class=&quot;language-scala&quot;&gt;&lt;code class=&quot;language-scala&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; scalaz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Scalaz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Refined
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;collection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NonEmpty
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scalaz&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;auto&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;eu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timepit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refined&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refineV&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;scala&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;io&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;StdIn&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_

&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; Prob3 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; NonEmptyString &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; Refined NonEmpty

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Array&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    refineV&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;readLine&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;What&apos;s your name? &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; Right&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt; println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; _ &lt;span class=&quot;token keyword&quot;&gt;=&gt;&lt;/span&gt;
        println&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You didn&apos;t enter a name!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        main&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; greet&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; Refined NonEmpty&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; s&lt;span class=&quot;token string&quot;&gt;&quot;Hello, $name!&quot;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; s&lt;span class=&quot;token string&quot;&gt;&quot;Go away, $name!&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item></channel></rss>